/**
 * HCS-U7 Widget v3.0.0 — Enterprise Adaptive Engine
 * Copyright (c) 2025-2026 Benjamin BARRERE / IA SOLUTION
 * Patents Pending FR2514274 | FR2514546
 * Built: 2026-02-12T07:15:52.813Z
 * DO NOT EDIT — generated from src/widget-v3/
 */
"use strict";(()=>{var bt=Object.defineProperty;var ke=Object.getOwnPropertySymbols;var ht=Object.prototype.hasOwnProperty,yt=Object.prototype.propertyIsEnumerable;var we=(e,t,n)=>t in e?bt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,v=(e,t)=>{for(var n in t||(t={}))ht.call(t,n)&&we(e,n,t[n]);if(ke)for(var n of ke(t))yt.call(t,n)&&we(e,n,t[n]);return e};function xe(){return typeof window!="undefined"&&typeof document!="undefined"}function Se(){try{return window.location.href}catch(e){return""}}function Ee(){try{return document.referrer}catch(e){return""}}function V(){try{let e="__hcs_test__";return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch(e){return!1}}function T(){try{let e="__hcs_test__";return sessionStorage.setItem(e,"1"),sessionStorage.removeItem(e),!0}catch(e){return!1}}var vt="https://api.hcs-u7.org",r={config:{apiUrl:vt,version:"3.0.0",debug:!1,env:"production",token:null,tenantId:null,widgetPublicId:null,tokenPayload:null},remoteConfig:null,sessionValidated:!1,sessionToken:null,lastDecision:null,lastRisk:null,lastValidation:null,lastSeen:0,degraded:!1,ready:!1,bunkerActive:!1,emaScore:0};function S(e){let t=5381;for(let n=0;n<e.length;n++)t=(t<<5)+t+e.charCodeAt(n)|0;return Math.abs(t).toString(36)}function kt(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=t*16777619|0;return t>>>0}function Ce(e){try{let n=(e+"====".substring(0,(4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent(atob(n).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join(""))}catch(t){return null}}function O(e){return!e||e.length<8?"***":e.substring(0,4)+"..."+e.substring(e.length-3)}function De(e){let t=JSON.stringify(e),n=90,o=new Uint8Array(t.length);for(let s=0;s<t.length;s++)o[s]=t.charCodeAt(s)^n;let i="";for(let s=0;s<o.length;s++)i+=String.fromCharCode(o[s]);return btoa(i)}function ee(e){return"s"+kt(e).toString(36)}var z=[],te=!1;function I(e){te=e}function F(){return te}function c(e,t){if(!te)return;let n={t:Date.now(),cat:e,data:t};z.push(n),z.length>200&&z.shift(),console.debug("[HCS-U7]["+e+"]",t)}function x(e){console.error("[HCS-U7] "+e)}function Ae(){return z.slice()}function Te(e){if(!e||typeof e!="string")return null;let t=e.split(".");if(t.length!==2)return null;let n=Ce(t[0]);if(!n)return null;try{let o=JSON.parse(n);return!o.tid||!o.exp||!o.v?null:o}catch(o){return null}}function Ie(e){return!e||e.includes(".")?!1:!!(/^[0-9a-f]{8}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{12}$/i.test(e)||/^c[a-z0-9]{20,30}$/.test(e))}function Re(){let e=r.config,t=document.querySelectorAll('script[data-widget], script[data-tenant], script[src*="hcs-widget"]'),n=null;for(let o=0;o<t.length;o++)if(t[o].getAttribute("data-widget")||t[o].getAttribute("data-tenant")||(t[o].getAttribute("src")||"").indexOf("hcs-widget")!==-1){n=t[o];break}if(n&&n.getAttribute("data-widget")){e.widgetPublicId=n.getAttribute("data-widget");let o=n.getAttribute("data-tenant");if(o)if(Ie(o))e.tenantId=o;else{let i=Te(o);i&&(e.token=o,e.tokenPayload=i,e.tenantId=i.tid)}c("init","Widget public ID from data-widget")}else if(n&&n.getAttribute("data-tenant")){let o=n.getAttribute("data-tenant");if(Ie(o))e.tenantId=o,e.token=null,c("init","Legacy tenant ID from data-tenant");else{let i=Te(o);if(i)e.token=o,e.tokenPayload=i,e.tenantId=i.tid,i.dbg&&(e.debug=!0),i.env&&(e.env=i.env),c("init","Signed token parsed, tenant: "+O(i.tid));else return x("Invalid data-tenant token format"),!1}}else if(window.HCS_TENANT_ID)e.tenantId=window.HCS_TENANT_ID,e.token=null,c("init","Legacy window.HCS_TENANT_ID mode");else return x("Missing data-widget, data-tenant, or window.HCS_TENANT_ID"),!1;return n&&(n.getAttribute("data-debug")==="true"&&(e.debug=!0),n.getAttribute("data-env")&&(e.env=n.getAttribute("data-env")),n.getAttribute("data-api")&&(e.apiUrl=n.getAttribute("data-api"))),I(e.debug),c("init","Widget v"+e.version+" | tenant: "+O(e.tenantId)+" | mode: "+(e.token?"signed_token":"legacy")),!0}function f(e,t,n){let o=document.createElement(e);return o.style.cssText=t,n!==void 0&&(o.textContent=n),o}function R(e,...t){for(let n of t)e.appendChild(n)}function E(e){let t=document.getElementById(e);t&&t.remove()}function ne(e){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()}function M(e){document.body?document.body.appendChild(e):ne(()=>document.body.appendChild(e))}var N=0,W=null,ie=0,_e=0,b=[],D=[],j=[],se=[],Be=0,P={},G=[],K=[],X=[],ae=0,Le=0,Ve=0,ce=[],Me=0,oe=0,Oe=0,re=0,Fe=0,He=[],Ue=[],ze=0,k=[];function y(e){if(!e.length)return 0;let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}function C(e){if(e.length<2)return 0;let t=y(e),n=0;for(let o=0;o<e.length;o++)n+=(e[o]-t)*(e[o]-t);return Math.sqrt(n/(e.length-1))}function Ne(e,t,n){let o=t.x-e.x,i=t.y-e.y,s=n.x-t.x,a=n.y-t.y,u=Math.abs(o*a-i*s),d=Math.sqrt(o*o+i*i),m=Math.sqrt(s*s+a*a),l=n.x-e.x,g=n.y-e.y,p=Math.sqrt(l*l+g*g),h=d*m*p;return h===0?0:2*u/h}function We(e){if(e.length<5)return .5;let t=[];for(let l=1;l<e.length;l++)t.push(e[l]-e[l-1]);let n=20,o=1/0,i=-1/0;for(let l of t)l<o&&(o=l),l>i&&(i=l);let s=i-o;if(s===0)return 0;let a=new Array(n).fill(0);for(let l of t)a[Math.min(Math.floor((l-o)/s*n),n-1)]++;let u=0,d=t.length;for(let l of a)if(l>0){let g=l/d;u-=g*Math.log2(g)}let m=Math.log2(n);return m>0?u/m:0}function wt(e){if(e.length<3)return 0;let t=y(e),n=C(e);if(n===0)return 0;let o=e.length,i=0;for(let s of e)i+=Math.pow((s-t)/n,3);return o/((o-1)*(o-2))*i}function xt(e){if(e.length<4)return 3;let t=y(e),n=C(e);if(n===0)return 0;let o=0;for(let i of e)o+=Math.pow((i-t)/n,4);return o/e.length-3}function St(){if(b.length<10)return!1;let e=b.slice(-50),t=0,n=0;for(let o=2;o<e.length;o++)n++,Ne(e[o-2],e[o-1],e[o])<.001&&t++;return n>0&&t/n>.8}function Et(){if(k.length<10)return .5;let e=[];for(let o=1;o<k.length;o++)e.push(k[o]-k[o-1]);let t=0;if(e.length>2){let o=y(e),i=C(e);if(i>0){let s=0;for(let a=1;a<e.length;a++)s+=(e[a]-o)/i*((e[a-1]-o)/i);t=s/(e.length-1)}}let n=We(k);return n>.85&&Math.abs(t)<.1?.9:n<.15?.1:n}function A(){let e=Date.now();W===null&&(W=e),e-ie>3e3&&_e++,ie=e,k.length<500&&k.push(e)}function Ct(e){A();let t={x:e.clientX,y:e.clientY,t:performance.now()};if(b.length>0){let n=b[b.length-1],o=t.t-n.t;if(o>0){let i=t.x-n.x,s=t.y-n.y,u=Math.sqrt(i*i+s*s)/o;if(D.length<500&&D.push(u),D.length>=2){let d=D[D.length-2];j.length<500&&j.push((u-d)/o)}if(b.length>=2){let d=b[b.length-2];se.length<500&&se.push(Ne(d,n,t))}}}b.length<500?b.push(t):b[b.length-1]=t}function Dt(){A(),Be++}function At(e){if(A(),["Shift","Control","Alt","Meta"].indexOf(e.key)!==-1)return;let t=performance.now();if(ae>0){let o=t-ae;o>0&&o<5e3&&X.length<500&&X.push(o)}let n=Object.keys(P);if(n.length>0&&G.length<500){let o=0;for(let s of n)P[s]>o&&(o=P[s]);let i=t-o;i>0&&i<5e3&&G.push(i)}P[e.code]=t,Le++}function Tt(e){if(["Shift","Control","Alt","Meta"].indexOf(e.key)!==-1)return;let t=performance.now(),n=P[e.code];if(n!==void 0){let o=t-n;o>0&&o<2e3&&K.length<500&&K.push(o),delete P[e.code]}ae=t}function It(){A(),Ve++;let e=performance.now(),t=window.scrollY||document.documentElement.scrollTop,n=e-oe;if(n>0&&oe>0){let o=t-Me;ce.length<500&&ce.push(Math.abs(o)/n);let i=o>0?1:o<0?-1:0;i!==0&&i!==re&&re!==0&&Oe++,i!==0&&(re=i)}Me=t,oe=e}function Rt(e){A(),Fe++;for(let t=0;t<e.touches.length;t++){let n=e.touches[t];n.force!==void 0&&n.force>0&&He.push(n.force),n.radiusX!==void 0&&Ue.push((n.radiusX+n.radiusY)/2)}}function Pe(){A(),ze++}function je(){N=Date.now(),ie=N;let e={passive:!0};document.addEventListener("mousemove",Ct,e),document.addEventListener("click",Dt,e),document.addEventListener("keydown",At,e),document.addEventListener("keyup",Tt,e),document.addEventListener("scroll",It,{passive:!0,capture:!0}),document.addEventListener("touchstart",Rt,e),document.addEventListener("touchmove",()=>A(),e),document.addEventListener("copy",Pe,e),document.addEventListener("paste",Pe,e)}function _(){let t=(Date.now()-N)/1e3,n=[];for(let o=1;o<k.length;o++)n.push(k[o]-k[o-1]);return{keystrokeIntervalAvg:y(G),keystrokeIntervalStd:C(G),keystrokeDwellAvg:y(K),keystrokeDwellStd:C(K),keystrokes:Le,flightTimeAvg:y(X),flightTimeStd:C(X),mouseVelocityAvg:y(D),mouseVelocityStd:C(D),mouseAccelerationAvg:y(j),mouseAccelerationStd:C(j),mouseCurvatureAvg:y(se),mouseMovements:b.length,mouseClicks:Be,noMouseMovement:b.length===0,linearMovement:St(),scrollEvents:Ve,scrollVelocityAvg:y(ce),scrollDirectionChanges:Oe,touchEvents:Fe,touchPressureAvg:y(He),touchRadiusAvg:y(Ue),timeToFirstInteraction:W?(W-N)/1e3:t,sessionDuration:t,idleGaps:_e,timingEntropy:We(k),copyPasteEvents:ze,pageViews:1,microTimingEntropy:Et(),timingDistributionSkewness:wt(n),timingDistributionKurtosis:xt(n)}}function B(){let e=navigator;return{userAgent:e.userAgent||"",language:e.language||"",languages:e.languages||[],platform:e.platform||"",hardwareConcurrency:e.hardwareConcurrency||0,deviceMemory:e.deviceMemory||null,screenResolution:screen.width+"x"+screen.height,colorDepth:screen.colorDepth||0,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timezoneOffset:new Date().getTimezoneOffset(),webdriver:!!e.webdriver,plugins:e.plugins?e.plugins.length:0,canvas:Mt(),webgl:Pt(),touchSupport:"ontouchstart"in window,cookieEnabled:!!e.cookieEnabled,doNotTrack:e.doNotTrack||null,timestamp:Date.now()}}function Mt(){try{let e=document.createElement("canvas"),t=e.getContext("2d");return t?(e.width=200,e.height=50,t.textBaseline="top",t.font="14px Arial",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText("HCS-U7",2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText("HCS-U7",4,17),S(e.toDataURL())):""}catch(e){return""}}function Pt(){try{let e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return"";let n=t.getExtension("WEBGL_debug_renderer_info");if(!n)return"";let o=t.getParameter(n.UNMASKED_VENDOR_WEBGL),i=t.getParameter(n.UNMASKED_RENDERER_WEBGL);return S(o+"~"+i)}catch(e){return""}}var q={allow:30,soft:55,challenge:80,bunker:95};var le={mode:"adaptive",thresholds:v({},q),softActions:["pow-lite","js-attestation","silent-retry","token-refresh"],challengeActions:["cognitive-lite"],bunkerPolicy:{enabled:!0,ttlSeconds:900},sampling:{telemetry:.25,fullSignals:.1},privacy:{maskPII:!0},timeouts:{configMs:800,validateMs:1200,pingMs:400},ui:{showBadge:!1,showToastOnChallenge:!0},killSwitch:!1,updatedAt:"",ttlSeconds:300},L=null;function Ke(){let e=r.config.widgetPublicId||r.config.tenantId||"unknown",t=typeof window!="undefined"?window.location.hostname:"";return"hcs:cfg:"+e+":"+t}function _t(){if(!V())return null;try{let e=localStorage.getItem(Ke());if(!e)return null;let t=JSON.parse(e);return!t.config||!t.fetchedAt?null:t}catch(e){return null}}function Bt(e){if(V())try{localStorage.setItem(Ke(),JSON.stringify(e))}catch(t){}}function Ge(e){let t=(e.config.ttlSeconds||300)*1e3;return Date.now()-e.fetchedAt<t}async function Xe(){var i,s;if(L&&Ge(L))return c("config","Using memory cache"),L.config;let e=_t();if(e&&Ge(e))return L=e,c("config","Using localStorage cache"),e.config;let t=r.config.widgetPublicId,n=r.config.tenantId;if(!t&&!n)return c("config","No widgetPublicId or tenantId \u2014 using safe defaults"),le;let o=((s=(i=e==null?void 0:e.config)==null?void 0:i.timeouts)==null?void 0:s.configMs)||le.timeouts.configMs;try{let a=new AbortController,u=setTimeout(()=>a.abort(),o),d=t?"widgetPublicId="+encodeURIComponent(t):"tenantId="+encodeURIComponent(n),m=r.config.apiUrl+"/api/widgets/config?"+d,l=await fetch(m,{method:"GET",signal:a.signal,headers:{"X-HCS-Widget-Version":r.config.version}});if(clearTimeout(u),!l.ok)throw new Error("HTTP "+l.status);let g=await l.json();g.widgetPublicId&&!r.config.widgetPublicId&&(r.config.widgetPublicId=g.widgetPublicId,c("config","Resolved widgetPublicId from backend: "+g.widgetPublicId.slice(0,6)+"..."));let p=g.config||g;if(!p.thresholds||typeof p.mode!="string")throw new Error("Invalid config shape");let h={config:p,fetchedAt:Date.now()};return L=h,Bt(h),c("config","Fetched remote config (mode="+p.mode+")"),p}catch(a){return x("config_fetch_failed: "+((a==null?void 0:a.message)||"unknown")),e?(c("config","Using stale localStorage cache as fallback"),L=e,e.config):(c("config","No cache \u2014 using safe defaults"),le)}}function qe(e){let t=[],n=0;e.webdriver&&(t.push("a1"),n+=50),e.plugins===0&&(t.push("a2"),n+=20);let o=["headless","phantom","selenium","puppeteer","bot","crawler","spider"],i=e.userAgent.toLowerCase();return o.some(s=>i.indexOf(s)!==-1)&&(t.push("a3"),n+=40),e.languages.length===0&&(t.push("a4"),n+=15),(e.hardwareConcurrency===0||e.hardwareConcurrency>32)&&(t.push("a5"),n+=10),(!e.canvas||e.canvas.length<5)&&(t.push("a6"),n+=25),(!e.webgl||e.webgl.length<5)&&(t.push("a7"),n+=20),e.cookieEnabled||(t.push("a8"),n+=10),(e.timezone==="UTC"||e.timezoneOffset===0)&&(t.push("a9"),n+=5),{score:Math.min(100,n),signals:t,suspicious:n>=50}}function Je(e){let t=[],n=0;return e.noMouseMovement&&e.sessionDuration>2&&(t.push("b1"),n+=15),e.linearMovement&&(t.push("b2"),n+=20),e.keystrokes===0&&e.sessionDuration>5&&(t.push("b3"),n+=5),e.microTimingEntropy>.85&&(t.push("b4"),n+=25),e.microTimingEntropy<.15&&e.sessionDuration>2&&(t.push("b5"),n+=20),e.timeToFirstInteraction<.1&&e.sessionDuration>1&&(t.push("b6"),n+=15),e.idleGaps===0&&e.sessionDuration>30&&(t.push("b7"),n+=10),e.keystrokeDwellStd<5&&e.keystrokes>10&&(t.push("b8"),n+=15),e.mouseCurvatureAvg<.001&&e.mouseMovements>20&&(t.push("b9"),n+=15),{score:Math.min(100,n),signals:t}}function Ye(){return{storageAvailable:V()&&T(),cookiesEnabled:!!navigator.cookieEnabled,cspBlocked:!1,adblockDetected:!1}}function w(e){return Math.max(0,Math.min(100,e))}function $e(e,t){var i;let n=0,o=0;for(let s of Object.keys(t)){let a=(i=e[s])!=null?i:0,u=t[s];n+=w(a)*u,o+=u}return o>0?w(n/o):0}function ue(e,t,n=.3){return e===0?t:w(n*t+(1-n)*e)}function Ze(e,t){return w(e*.4+t*.6)}function Qe(e){var a;if(typeof window=="undefined")return e;let t=((a=window.location)==null?void 0:a.hostname)||"",n=document.referrer||"",o=t==="localhost"||t==="127.0.0.1"||t==="0.0.0.0",i=n==="",s=!!window.__REACT_DEVTOOLS_GLOBAL_HOOK__||typeof window.__VUE_DEVTOOLS_GLOBAL_HOOK__!="undefined";return o||s||i?w(e*.6):e}function H(){return Math.floor(Date.now()/1e3)}function et(e){return new Promise(t=>setTimeout(t,e))}function tt(e,t=.2){let n=e*t;return e+(Math.random()*2-1)*n}var Lt={fingerprint:.25,behavior:.3,automation:.2,integrity:.1,velocity:.1,network:.05},de=0;function nt(){let e=[],t=B(),n=qe(t);e.push(...n.signals);let o=_(),i=Je(o);e.push(...i.signals);let s=0;t.webdriver&&(s+=60),n.signals.includes("a3")&&(s+=40),s=w(s);let a=Ye(),u=0;a.storageAvailable||(u+=20,e.push("i1")),a.cookiesEnabled||(u+=15,e.push("i2")),a.cspBlocked&&(u+=10,e.push("i3")),u=w(u);let d=0,m=H();de>0&&m-de<2&&(d=30,e.push("v1")),de=m;let g={fingerprint:w(n.score),behavior:w(i.score),automation:s,integrity:u,velocity:d,network:0},p=$e(g,Lt),h={total:p,components:g,reasons:e};return c("risk","Score: "+Math.round(p)+" | reasons: "+e.join(", ")),r.lastRisk=h,h}function ot(e,t){var i,s,a;let n=(i=t==null?void 0:t.thresholds)!=null?i:q,o=e.total;return t!=null&&t.killSwitch||(t==null?void 0:t.mode)==="monitor"?"allow":(s=t==null?void 0:t.bunkerPolicy)!=null&&s.enabled&&o>=n.bunker?"bunker":o<n.allow?"allow":o<n.soft?"soft":o<n.challenge?"challenge":o<n.bunker?"hard_challenge":(a=t==null?void 0:t.bunkerPolicy)!=null&&a.enabled?"bunker":"block"}function rt(){c("action","ALLOW \u2014 no friction")}function Vt(){return new Promise(e=>{let t=150+Math.random()*150,n=performance.now(),o=0,i=0;function s(){let a=performance.now()+5;for(;performance.now()<a;)o=(o<<5)-o+i|0,i++;performance.now()-n>=t?(c("soft","PoW-lite completed: "+i+" iterations in "+Math.round(performance.now()-n)+"ms"),e()):setTimeout(s,0)}s()})}function Ot(){return new Promise(e=>{let t=performance.now(),o=document.createElement("canvas").getContext("2d");o&&o.fillText("attest",0,0);let i=[typeof window.requestAnimationFrame=="function",typeof document.createTreeWalker=="function",typeof window.getComputedStyle=="function"],s=performance.now()-t;c("soft","JS attestation: "+i.filter(Boolean).length+"/3 checks, "+Math.round(s)+"ms"),e()})}async function Ft(){let e=tt(500,.3);c("soft","Silent retry in "+Math.round(e)+"ms"),await et(e)}function Ht(){c("soft","Token refresh requested")}async function J(){var t,n;let e=(n=(t=r.remoteConfig)==null?void 0:t.softActions)!=null?n:["pow-lite","js-attestation"];c("action","SOFT \u2014 executing: "+e.join(", "));for(let o of e)switch(o){case"pow-lite":await Vt();break;case"js-attestation":await Ot();break;case"silent-retry":await Ft();break;case"token-refresh":Ht();break;default:c("soft","Unknown soft action: "+o)}}var fe="hcs-challenge-overlay";async function it(e=!1){var n,o,i,s;let t=e?(o=(n=r.remoteConfig)==null?void 0:n.challengeActions)!=null?o:["cognitive-lite"]:["cognitive-lite"];c("action",(e?"HARD_":"")+"CHALLENGE \u2014 actions: "+t.join(", "));for(let a of t)switch(a){case"cognitive-lite":return me();case"voice-if-enabled":return(s=(i=r.remoteConfig)==null?void 0:i.challengeActions)!=null&&s.includes("voice-if-enabled")&&c("challenge","Voice challenge not yet implemented \u2014 falling back to cognitive-lite"),me();default:return c("challenge","Unknown challenge action: "+a),me()}return!0}function me(){return new Promise(e=>{E(fe);let t=30+Math.floor(Math.random()*40),n=5,o=Date.now(),i=f("div","position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:999999;");i.id=fe;let s=f("div","background:white;border-radius:12px;box-shadow:0 20px 25px -5px rgba(0,0,0,0.1);max-width:420px;width:90%;padding:30px;text-align:center;"),a=f("h3","margin:0 0 12px 0;color:#1e293b;font-family:system-ui,-apple-system,sans-serif;font-size:18px;","Human Verification"),u=f("p","margin:0 0 20px 0;color:#64748b;font-size:14px;font-family:system-ui,-apple-system,sans-serif;","Move the slider to "+t),d=document.createElement("input");d.type="range",d.min="0",d.max="100",d.value="0",d.style.cssText="width:100%;margin:16px 0;cursor:pointer;";let m=f("div","font-size:28px;font-weight:bold;color:#3b82f6;font-family:system-ui,-apple-system,sans-serif;margin-bottom:16px;","0"),l=f("button","padding:10px 30px;background:#3b82f6;color:white;border:none;border-radius:6px;cursor:pointer;font-size:15px;font-family:system-ui,-apple-system,sans-serif;font-weight:600;","Validate"),g=f("p","color:#cbd5e1;font-size:10px;margin-top:16px;margin-bottom:0;font-family:system-ui,-apple-system,sans-serif;","Protected by HCS-U7");d.addEventListener("input",()=>{m.textContent=d.value}),l.addEventListener("click",()=>{let p=parseInt(d.value,10),h=Math.abs(p-t)<=n,U=Date.now()-o;c("challenge","Cognitive-lite result: "+(h?"PASS":"FAIL")+" (value="+p+", target="+t+", duration="+U+"ms)"),E(fe),e(h)}),R(s,a,u,d,m,l,g),i.appendChild(s),M(i)})}var ge="hcs-bunker-overlay",Y="hcs:bunker:whitelist";function Ut(){if(!T())return!1;try{let e=sessionStorage.getItem(Y);if(!e)return!1;let t=JSON.parse(e);if(t.expiresAt>H()&&t.token)return c("bunker","Session whitelisted until "+new Date(t.expiresAt*1e3).toISOString()),!0;sessionStorage.removeItem(Y)}catch(e){}return!1}function zt(e,t){if(T())try{let n={token:e,expiresAt:H()+t};sessionStorage.setItem(Y,JSON.stringify(n))}catch(n){}}async function pe(){if(Ut()){c("bunker","Whitelisted \u2014 passing through"),r.sessionValidated=!0;return}return c("action","BUNKER \u2014 strict verification gate"),new Promise(e=>{var U,he,ye;E(ge);let t=(ye=(he=(U=r.remoteConfig)==null?void 0:U.bunkerPolicy)==null?void 0:he.ttlSeconds)!=null?ye:900,n=f("div","position:fixed;top:0;left:0;width:100%;height:100%;background:#0f172a;display:flex;align-items:center;justify-content:center;z-index:999999;font-family:system-ui,-apple-system,sans-serif;");n.id=ge;let o=f("div","text-align:center;max-width:400px;padding:40px;"),i=f("div","font-size:48px;margin-bottom:16px;","\u{1F6E1}\uFE0F"),s=f("h2","color:#f1f5f9;margin:0 0 8px 0;font-size:22px;","Security Verification Required"),a=f("p","color:#94a3b8;margin:0 0 24px 0;font-size:14px;line-height:1.5;","Enhanced security is active. Please complete the verification to continue."),u=40+Math.floor(Math.random()*20),d=3,m=f("p","color:#cbd5e1;margin:0 0 16px 0;font-size:13px;","Move the slider precisely to "+u),l=document.createElement("input");l.type="range",l.min="0",l.max="100",l.value="0",l.style.cssText="width:100%;margin:12px 0;cursor:pointer;";let g=f("div","font-size:32px;font-weight:bold;color:#60a5fa;margin-bottom:20px;","0"),p=f("button","padding:12px 36px;background:#3b82f6;color:white;border:none;border-radius:8px;cursor:pointer;font-size:15px;font-weight:600;","Verify"),h=f("p","color:#475569;font-size:10px;margin-top:24px;margin-bottom:0;","Protected by HCS-U7 Bunker Mode");l.addEventListener("input",()=>{g.textContent=l.value}),p.addEventListener("click",()=>{let ve=parseInt(l.value,10);Math.abs(ve-u)<=d?(c("bunker","Verification passed \u2014 whitelisting for "+t+"s"),zt(r.sessionToken||"bunker-pass",t),r.sessionValidated=!0,E(ge),e()):(m.textContent="Incorrect. Try again \u2014 move to "+u,m.style.color="#f87171",l.value="0",g.textContent="0",c("bunker","Verification failed (value="+ve+", target="+u+")"))}),R(o,i,s,a,m,l,g,p,h),n.appendChild(o),M(n)})}function st(){if(T())try{sessionStorage.removeItem(Y),c("bunker","Whitelist cleared (bunker exit)")}catch(e){}}function $(e){c("action","BLOCK \u2014 reason: "+e);let t=f("div","display:flex;align-items:center;justify-content:center;min-height:100vh;background:#f1f5f9;font-family:system-ui,-apple-system,sans-serif;"),n=f("div","text-align:center;max-width:500px;padding:40px;"),o=f("div","font-size:64px;margin-bottom:20px;","\u{1F6E1}\uFE0F"),i=f("h1","color:#1e293b;margin:0 0 10px 0;font-size:24px;","Access Blocked"),s=f("p","color:#64748b;margin:0 0 20px 0;font-size:15px;","Your access has been blocked by HCS-U7 Protection."),a=f("p","color:#94a3b8;font-size:13px;","Reason: "+(typeof e=="string"?e:"Unknown")),u=f("p","color:#94a3b8;font-size:11px;margin-top:30px;","Protected by HCS-U7");R(n,o,i,s,a,u),t.appendChild(n),document.body.textContent="",document.body.appendChild(t)}async function Z(e,t={}){var i;let n=r.config.apiUrl+e,o=(i=t.timeoutMs)!=null?i:1200;try{let s=new AbortController,a=setTimeout(()=>s.abort(),o),u=v({"X-HCS-Widget-Version":r.config.version},t.headers||{});t.body&&(u["Content-Type"]="application/json");let d=await fetch(n,{method:t.method||"GET",signal:s.signal,headers:u,body:t.body?JSON.stringify(t.body):void 0});return clearTimeout(a),d.ok?d.status===204?null:await d.json():(c("api","HTTP "+d.status+" from "+e),null)}catch(s){return(s==null?void 0:s.name)==="AbortError"?x("Timeout ("+o+"ms) on "+e):c("api","Fetch error on "+e+": "+((s==null?void 0:s.message)||"unknown")),null}}function Nt(e){let t=e.fingerprint;return v(v(v({f:{ua:S(t.userAgent),l:t.language,p:S(t.platform),hc:t.hardwareConcurrency,sr:t.screenResolution,cd:t.colorDepth,tz:t.timezoneOffset,wd:t.webdriver,pl:t.plugins,cv:t.canvas,gl:t.webgl,ts:t.touchSupport,ck:t.cookieEnabled},bs:{s:e.botSignals.score,r:e.botSignals.signals.map(ee)},bh:{nm:e.behavior.noMouseMovement,lm:e.behavior.linearMovement,ks:e.behavior.keystrokes,mt:Math.round(e.behavior.microTimingEntropy*100),ti:Math.round(e.behavior.timeToFirstInteraction*100),ig:e.behavior.idleGaps,sd:Math.round(e.behavior.sessionDuration),mc:Math.round(e.behavior.mouseCurvatureAvg*1e3),mm:e.behavior.mouseMovements},rb:{t:Math.round(e.riskBreakdown.total),c:Object.fromEntries(Object.entries(e.riskBreakdown.components).map(([n,o])=>[n[0],Math.round(o)])),r:e.riskBreakdown.reasons.map(ee)},u:S(e.url),rf:S(e.referrer)},e.token?{tk:e.token}:{}),e.tenantId?{ti:e.tenantId}:{}),e.widgetPublicId?{wp:e.widgetPublicId}:{})}async function at(e){var u,d,m,l;let t=r.config,n=(m=(d=(u=r.remoteConfig)==null?void 0:u.timeouts)==null?void 0:d.validateMs)!=null?m:1200,o={fingerprint:B(),botSignals:{score:e.components.fingerprint,signals:e.reasons},behavior:_(),riskBreakdown:e,url:Se(),referrer:Ee()};t.token?o.token=t.token:t.tenantId&&(o.tenantId=t.tenantId),t.widgetPublicId&&(o.widgetPublicId=t.widgetPublicId);let i=Nt(o),s=De(i),a=await Z("/widget/validate",{method:"POST",body:{_e:s,_v:3},timeoutMs:n});return a?(c("validate","Server response: action="+a.action+" serverRisk="+((l=a.serverRisk)!=null?l:"n/a")),a.token&&(r.sessionToken=a.token),{action:a.action,token:a.token,expiresIn:a.expiresIn,serverRisk:a.serverRisk,flags:a.flags,reason:a.reason,score:a.score}):(c("validate","Backend unreachable \u2014 degraded mode"),r.degraded=!0,{action:"allow",reason:"api_unreachable",score:0})}async function ct(){var t,n,o,i,s,a;if(r.sessionValidated)return c("decision","Already validated this session"),(t=r.lastDecision)!=null?t:"allow";((o=(n=r.remoteConfig)==null?void 0:n.mode)!=null?o:"adaptive")!=="enforce"&&r.bunkerActive&&(c("decision","Bunker exit detected \u2014 resetting bunker state"),r.bunkerActive=!1,r.sessionToken=null,r.emaScore=0,st());try{let u=nt();u.total=Qe(u.total),r.emaScore=ue(r.emaScore,u.total,.3),u.total=r.emaScore;let d=await at(u);if(!d||d.reason==="api_unreachable")return c("decision","API unreachable \u2014 monitor-only mode (soft actions only)"),r.degraded=!0,r.lastDecision="soft",r.lastSeen=Date.now(),await J(),r.sessionValidated=!0,"soft";let m=u.total;if(d.serverRisk!==void 0&&(m=Ze(u.total,d.serverRisk),r.emaScore=ue(r.emaScore,m,.3),m=r.emaScore,u.total=m),d.action==="block")return r.lastDecision="block",r.lastValidation=d,$(d.reason||"Server decision"),"block";if(d.action==="bunker"&&((s=(i=r.remoteConfig)==null?void 0:i.bunkerPolicy)!=null&&s.enabled))return r.lastDecision="bunker",r.lastValidation=d,r.bunkerActive=!0,await pe(),"bunker";let l=ot(u,r.remoteConfig),g=(a=r.remoteConfig)==null?void 0:a.thresholds;switch(r.lastDecision==="allow"&&(l==="challenge"||l==="hard_challenge")&&g&&m<g.challenge+5&&(c("decision","Hysteresis: suppressing escalation allow\u2192"+l+" (score "+Math.round(m)+" < challenge+5)"),l="soft"),r.lastDecision==="soft"&&(l==="challenge"||l==="hard_challenge")&&g&&m<g.challenge+3&&(c("decision","Hysteresis: suppressing escalation soft\u2192"+l),l="soft"),r.lastDecision=l,r.lastValidation=d,r.lastSeen=Date.now(),d.token&&(r.sessionToken=d.token),l==="bunker"&&(r.bunkerActive=!0),c("decision","Decision: "+l+" (score: "+Math.round(m)+", ema: "+Math.round(r.emaScore)+")"),l){case"allow":rt(),r.sessionValidated=!0;break;case"soft":await J(),r.sessionValidated=!0;break;case"challenge":case"hard_challenge":if(await it(l==="hard_challenge"))r.sessionValidated=!0;else return $("Challenge failed"),r.lastDecision="block","block";break;case"bunker":await pe();break;case"block":$("Risk threshold exceeded");break}return l}catch(u){return c("decision","Pipeline error \u2014 monitor-only fail-safe: "+((u==null?void 0:u.message)||"unknown")),r.degraded=!0,r.lastDecision="soft",r.sessionValidated=!0,await J(),"soft"}}var lt=new Map;function ut(e,t,n){let o=Date.now(),i=lt.get(e);return(!i||o>=i.resetAt)&&(i={count:0,resetAt:o+n},lt.set(e,i)),i.count>=t?!1:(i.count++,!0)}async function dt(){var o,i,s;let e=r.config.widgetPublicId;if(!e)return;if(!ut("ping",1,3e4)){c("ping","Rate limited \u2014 skipping");return}let t=(s=(i=(o=r.remoteConfig)==null?void 0:o.timeouts)==null?void 0:i.pingMs)!=null?s:400;if(!await Z("/api/widgets/ping",{method:"POST",body:{widgetPublicId:e},timeoutMs:t})&&typeof document!="undefined")try{let a=r.config.apiUrl+"/api/widgets/ping.gif?widgetPublicId="+encodeURIComponent(e)+"&_="+Date.now(),u=new Image;u.src=a}catch(a){}c("ping","Sent")}var ft="hcs-debug-badge",mt="hcs-debug-score";function gt(){var o,i;if(!F()||!((i=(o=r.remoteConfig)==null?void 0:o.ui)!=null&&i.showBadge)&&!r.config.debug)return;E(ft);let e=f("div","position:fixed;bottom:10px;right:10px;background:rgba(30,41,59,0.8);color:#e2e8f0;padding:6px 12px;border-radius:8px;font-family:system-ui,-apple-system,sans-serif;font-size:11px;z-index:999998;cursor:pointer;user-select:none;backdrop-filter:blur(4px);border:1px solid rgba(148,163,184,0.2);");e.id=ft;let t=f("span","font-weight:600;","\u{1F6E1}\uFE0F HCS Debug "),n=f("span","margin-left:4px;","...");n.id=mt,e.appendChild(t),e.appendChild(n),e.addEventListener("click",()=>{var s;console.group("[HCS-U7] Debug Details"),console.log("Version:",r.config.version),console.log("Decision:",r.lastDecision),console.log("Risk:",r.lastRisk),console.log("Validation:",r.lastValidation),console.log("Degraded:",r.degraded),console.log("Remote config:",(s=r.remoteConfig)==null?void 0:s.mode),console.groupEnd()}),M(e)}function pt(e,t){if(!F())return;let n=document.getElementById(mt);if(!n)return;let o=t==="allow"?"#4ade80":t==="soft"?"#a3e635":t==="challenge"||t==="hard_challenge"?"#fbbf24":t==="bunker"?"#f97316":"#f87171",i=t==="allow"?"\u2705":t==="soft"?"\u{1F7E2}":t==="challenge"||t==="hard_challenge"?"\u26A0\uFE0F":t==="bunker"?"\u{1F6E1}\uFE0F":"\u274C";n.textContent=i+" "+Math.round(e),n.style.color=o}var Q="3.0.0";xe()&&(je(),Wt());async function Wt(){var e,t;if(Re()){r.config.version=Q,c("boot","Widget v"+Q+" booting");try{if(r.remoteConfig=await Xe(),c("boot","Remote config loaded (mode="+r.remoteConfig.mode+")"),r.remoteConfig.killSwitch){c("boot","Kill switch active \u2014 monitor only"),r.ready=!0,be();return}}catch(n){c("boot","Remote config failed \u2014 using safe defaults"),r.degraded=!0}(t=(e=r.remoteConfig)==null?void 0:e.ui)!=null&&t.showBadge&&I(!0),jt(),gt(),dt().catch(()=>{}),ne(async()=>{var n,o;try{let i=await ct();pt((o=(n=r.lastRisk)==null?void 0:n.total)!=null?o:0,i),r.ready=!0,r.lastSeen=Date.now(),be(),c("boot","Boot complete \u2014 decision: "+i)}catch(i){x("Boot decision failed: "+((i==null?void 0:i.message)||"unknown")),r.degraded=!0,r.ready=!0,be()}})}}function be(){let e={ready:r.ready,lastDecision:r.lastDecision,lastSeen:r.lastSeen,version:Q,degraded:r.degraded};try{Object.defineProperty(window,"HCS_STATUS",{value:Object.freeze(e),writable:!1,configurable:!0,enumerable:!0})}catch(t){window.HCS_STATUS=e}}function jt(){var n,o,i;if(window.__HCS_DEBUG__===!0&&I(!0),!F())return;let e=r.config;if(!(((n=e.tokenPayload)==null?void 0:n.dbg)||!e.token)){c("debug","Debug requested but not authorized by token"),I(!1);return}window.__HCS_DEBUG__=Object.freeze({version:Q,tenantId:O(e.tenantId),mode:(i=(o=r.remoteConfig)==null?void 0:o.mode)!=null?i:"unknown",env:e.env,getFingerprint:()=>B(),getBehavior:()=>_(),getLogs:()=>Ae(),getRisk:()=>r.lastRisk?v({},r.lastRisk):null,getDecision:()=>r.lastDecision,getConfig:()=>r.remoteConfig?v({},r.remoteConfig):null,isDegraded:()=>r.degraded,getStatus:()=>{var s,a,u,d;return{riskScore:Math.round(r.emaScore),decision:r.lastDecision,thresholds:(a=(s=r.remoteConfig)==null?void 0:s.thresholds)!=null?a:null,mode:(d=(u=r.remoteConfig)==null?void 0:u.mode)!=null?d:"unknown",bunkerActive:r.bunkerActive,degraded:r.degraded,sessionValidated:r.sessionValidated}}}),c("debug","Debug API exposed on window.__HCS_DEBUG__")}})();
