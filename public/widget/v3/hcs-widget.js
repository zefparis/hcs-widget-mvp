/**
 * HCS-U7 Widget v3.0.0 — Enterprise Adaptive Engine
 * Copyright (c) 2025-2026 Benjamin BARRERE / IA SOLUTION
 * Patents Pending FR2514274 | FR2514546
 * Built: 2026-02-11T23:05:12.597Z
 * DO NOT EDIT — generated from src/widget-v3/
 */
"use strict";(()=>{var bt=Object.defineProperty;var ke=Object.getOwnPropertySymbols;var ht=Object.prototype.hasOwnProperty,yt=Object.prototype.propertyIsEnumerable;var we=(e,t,n)=>t in e?bt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,y=(e,t)=>{for(var n in t||(t={}))ht.call(t,n)&&we(e,n,t[n]);if(ke)for(var n of ke(t))yt.call(t,n)&&we(e,n,t[n]);return e};function xe(){return typeof window!="undefined"&&typeof document!="undefined"}function Se(){try{return window.location.href}catch(e){return""}}function Ee(){try{return document.referrer}catch(e){return""}}function V(){try{let e="__hcs_test__";return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch(e){return!1}}function T(){try{let e="__hcs_test__";return sessionStorage.setItem(e,"1"),sessionStorage.removeItem(e),!0}catch(e){return!1}}var vt="https://api.hcs-u7.org",r={config:{apiUrl:vt,version:"3.0.0",debug:!1,env:"production",token:null,tenantId:null,widgetPublicId:null,tokenPayload:null},remoteConfig:null,sessionValidated:!1,sessionToken:null,lastDecision:null,lastRisk:null,lastValidation:null,lastSeen:0,degraded:!1,ready:!1,bunkerActive:!1,emaScore:0};function S(e){let t=5381;for(let n=0;n<e.length;n++)t=(t<<5)+t+e.charCodeAt(n)|0;return Math.abs(t).toString(36)}function kt(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=t*16777619|0;return t>>>0}function Ce(e){try{let n=(e+"====".substring(0,(4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent(atob(n).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join(""))}catch(t){return null}}function O(e){return!e||e.length<8?"***":e.substring(0,4)+"..."+e.substring(e.length-3)}function De(e){let t=JSON.stringify(e),n=90,o=new Uint8Array(t.length);for(let s=0;s<t.length;s++)o[s]=t.charCodeAt(s)^n;let i="";for(let s=0;s<o.length;s++)i+=String.fromCharCode(o[s]);return btoa(i)}function ee(e){return"s"+kt(e).toString(36)}var z=[],te=!1;function R(e){te=e}function F(){return te}function a(e,t){if(!te)return;let n={t:Date.now(),cat:e,data:t};z.push(n),z.length>200&&z.shift(),console.debug("[HCS-U7]["+e+"]",t)}function x(e){console.error("[HCS-U7] "+e)}function Ae(){return z.slice()}function Te(e){if(!e||typeof e!="string")return null;let t=e.split(".");if(t.length!==2)return null;let n=Ce(t[0]);if(!n)return null;try{let o=JSON.parse(n);return!o.tid||!o.exp||!o.v?null:o}catch(o){return null}}function Re(e){return!e||e.includes(".")?!1:!!(/^[0-9a-f]{8}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{12}$/i.test(e)||/^c[a-z0-9]{20,30}$/.test(e))}function Ie(){let e=r.config,t=document.querySelectorAll('script[data-widget], script[data-tenant], script[src*="hcs-widget"]'),n=null;for(let o=0;o<t.length;o++)if(t[o].getAttribute("data-widget")||t[o].getAttribute("data-tenant")||(t[o].getAttribute("src")||"").indexOf("hcs-widget")!==-1){n=t[o];break}if(n&&n.getAttribute("data-widget")){e.widgetPublicId=n.getAttribute("data-widget");let o=n.getAttribute("data-tenant");if(o)if(Re(o))e.tenantId=o;else{let i=Te(o);i&&(e.token=o,e.tokenPayload=i,e.tenantId=i.tid)}a("init","Widget public ID from data-widget")}else if(n&&n.getAttribute("data-tenant")){let o=n.getAttribute("data-tenant");if(Re(o))e.tenantId=o,e.token=null,a("init","Legacy tenant ID from data-tenant");else{let i=Te(o);if(i)e.token=o,e.tokenPayload=i,e.tenantId=i.tid,i.dbg&&(e.debug=!0),i.env&&(e.env=i.env),a("init","Signed token parsed, tenant: "+O(i.tid));else return x("Invalid data-tenant token format"),!1}}else if(window.HCS_TENANT_ID)e.tenantId=window.HCS_TENANT_ID,e.token=null,a("init","Legacy window.HCS_TENANT_ID mode");else return x("Missing data-widget, data-tenant, or window.HCS_TENANT_ID"),!1;return n&&(n.getAttribute("data-debug")==="true"&&(e.debug=!0),n.getAttribute("data-env")&&(e.env=n.getAttribute("data-env")),n.getAttribute("data-api")&&(e.apiUrl=n.getAttribute("data-api"))),R(e.debug),a("init","Widget v"+e.version+" | tenant: "+O(e.tenantId)+" | mode: "+(e.token?"signed_token":"legacy")),!0}function m(e,t,n){let o=document.createElement(e);return o.style.cssText=t,n!==void 0&&(o.textContent=n),o}function I(e,...t){for(let n of t)e.appendChild(n)}function E(e){let t=document.getElementById(e);t&&t.remove()}function ne(e){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()}function M(e){document.body?document.body.appendChild(e):ne(()=>document.body.appendChild(e))}var N=0,W=null,ie=0,Pe=0,p=[],D=[],j=[],se=[],Be=0,_={},G=[],K=[],X=[],ae=0,Le=0,Ve=0,ce=[],Me=0,oe=0,Oe=0,re=0,Fe=0,He=[],Ue=[],ze=0,v=[];function b(e){if(!e.length)return 0;let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}function C(e){if(e.length<2)return 0;let t=b(e),n=0;for(let o=0;o<e.length;o++)n+=(e[o]-t)*(e[o]-t);return Math.sqrt(n/(e.length-1))}function Ne(e,t,n){let o=t.x-e.x,i=t.y-e.y,s=n.x-t.x,c=n.y-t.y,l=Math.abs(o*c-i*s),d=Math.sqrt(o*o+i*i),f=Math.sqrt(s*s+c*c),u=n.x-e.x,g=n.y-e.y,h=Math.sqrt(u*u+g*g),k=d*f*h;return k===0?0:2*l/k}function We(e){if(e.length<5)return .5;let t=[];for(let u=1;u<e.length;u++)t.push(e[u]-e[u-1]);let n=20,o=1/0,i=-1/0;for(let u of t)u<o&&(o=u),u>i&&(i=u);let s=i-o;if(s===0)return 0;let c=new Array(n).fill(0);for(let u of t)c[Math.min(Math.floor((u-o)/s*n),n-1)]++;let l=0,d=t.length;for(let u of c)if(u>0){let g=u/d;l-=g*Math.log2(g)}let f=Math.log2(n);return f>0?l/f:0}function wt(e){if(e.length<3)return 0;let t=b(e),n=C(e);if(n===0)return 0;let o=e.length,i=0;for(let s of e)i+=Math.pow((s-t)/n,3);return o/((o-1)*(o-2))*i}function xt(e){if(e.length<4)return 3;let t=b(e),n=C(e);if(n===0)return 0;let o=0;for(let i of e)o+=Math.pow((i-t)/n,4);return o/e.length-3}function St(){if(p.length<10)return!1;let e=p.slice(-50),t=0,n=0;for(let o=2;o<e.length;o++)n++,Ne(e[o-2],e[o-1],e[o])<.001&&t++;return n>0&&t/n>.8}function Et(){if(v.length<10)return .5;let e=[];for(let o=1;o<v.length;o++)e.push(v[o]-v[o-1]);let t=0;if(e.length>2){let o=b(e),i=C(e);if(i>0){let s=0;for(let c=1;c<e.length;c++)s+=(e[c]-o)/i*((e[c-1]-o)/i);t=s/(e.length-1)}}let n=We(v);return n>.85&&Math.abs(t)<.1?.9:n<.15?.1:n}function A(){let e=Date.now();W===null&&(W=e),e-ie>3e3&&Pe++,ie=e,v.length<500&&v.push(e)}function Ct(e){A();let t={x:e.clientX,y:e.clientY,t:performance.now()};if(p.length>0){let n=p[p.length-1],o=t.t-n.t;if(o>0){let i=t.x-n.x,s=t.y-n.y,l=Math.sqrt(i*i+s*s)/o;if(D.length<500&&D.push(l),D.length>=2){let d=D[D.length-2];j.length<500&&j.push((l-d)/o)}if(p.length>=2){let d=p[p.length-2];se.length<500&&se.push(Ne(d,n,t))}}}p.length<500?p.push(t):p[p.length-1]=t}function Dt(){A(),Be++}function At(e){if(A(),["Shift","Control","Alt","Meta"].indexOf(e.key)!==-1)return;let t=performance.now();if(ae>0){let o=t-ae;o>0&&o<5e3&&X.length<500&&X.push(o)}let n=Object.keys(_);if(n.length>0&&G.length<500){let o=0;for(let s of n)_[s]>o&&(o=_[s]);let i=t-o;i>0&&i<5e3&&G.push(i)}_[e.code]=t,Le++}function Tt(e){if(["Shift","Control","Alt","Meta"].indexOf(e.key)!==-1)return;let t=performance.now(),n=_[e.code];if(n!==void 0){let o=t-n;o>0&&o<2e3&&K.length<500&&K.push(o),delete _[e.code]}ae=t}function Rt(){A(),Ve++;let e=performance.now(),t=window.scrollY||document.documentElement.scrollTop,n=e-oe;if(n>0&&oe>0){let o=t-Me;ce.length<500&&ce.push(Math.abs(o)/n);let i=o>0?1:o<0?-1:0;i!==0&&i!==re&&re!==0&&Oe++,i!==0&&(re=i)}Me=t,oe=e}function It(e){A(),Fe++;for(let t=0;t<e.touches.length;t++){let n=e.touches[t];n.force!==void 0&&n.force>0&&He.push(n.force),n.radiusX!==void 0&&Ue.push((n.radiusX+n.radiusY)/2)}}function _e(){A(),ze++}function je(){N=Date.now(),ie=N;let e={passive:!0};document.addEventListener("mousemove",Ct,e),document.addEventListener("click",Dt,e),document.addEventListener("keydown",At,e),document.addEventListener("keyup",Tt,e),document.addEventListener("scroll",Rt,{passive:!0,capture:!0}),document.addEventListener("touchstart",It,e),document.addEventListener("touchmove",()=>A(),e),document.addEventListener("copy",_e,e),document.addEventListener("paste",_e,e)}function P(){let t=(Date.now()-N)/1e3,n=[];for(let o=1;o<v.length;o++)n.push(v[o]-v[o-1]);return{keystrokeIntervalAvg:b(G),keystrokeIntervalStd:C(G),keystrokeDwellAvg:b(K),keystrokeDwellStd:C(K),keystrokes:Le,flightTimeAvg:b(X),flightTimeStd:C(X),mouseVelocityAvg:b(D),mouseVelocityStd:C(D),mouseAccelerationAvg:b(j),mouseAccelerationStd:C(j),mouseCurvatureAvg:b(se),mouseMovements:p.length,mouseClicks:Be,noMouseMovement:p.length===0,linearMovement:St(),scrollEvents:Ve,scrollVelocityAvg:b(ce),scrollDirectionChanges:Oe,touchEvents:Fe,touchPressureAvg:b(He),touchRadiusAvg:b(Ue),timeToFirstInteraction:W?(W-N)/1e3:t,sessionDuration:t,idleGaps:Pe,timingEntropy:We(v),copyPasteEvents:ze,pageViews:1,microTimingEntropy:Et(),timingDistributionSkewness:wt(n),timingDistributionKurtosis:xt(n)}}function B(){let e=navigator;return{userAgent:e.userAgent||"",language:e.language||"",languages:e.languages||[],platform:e.platform||"",hardwareConcurrency:e.hardwareConcurrency||0,deviceMemory:e.deviceMemory||null,screenResolution:screen.width+"x"+screen.height,colorDepth:screen.colorDepth||0,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timezoneOffset:new Date().getTimezoneOffset(),webdriver:!!e.webdriver,plugins:e.plugins?e.plugins.length:0,canvas:Mt(),webgl:_t(),touchSupport:"ontouchstart"in window,cookieEnabled:!!e.cookieEnabled,doNotTrack:e.doNotTrack||null,timestamp:Date.now()}}function Mt(){try{let e=document.createElement("canvas"),t=e.getContext("2d");return t?(e.width=200,e.height=50,t.textBaseline="top",t.font="14px Arial",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText("HCS-U7",2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText("HCS-U7",4,17),S(e.toDataURL())):""}catch(e){return""}}function _t(){try{let e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return"";let n=t.getExtension("WEBGL_debug_renderer_info");if(!n)return"";let o=t.getParameter(n.UNMASKED_VENDOR_WEBGL),i=t.getParameter(n.UNMASKED_RENDERER_WEBGL);return S(o+"~"+i)}catch(e){return""}}var q={allow:30,soft:55,challenge:80,bunker:95};var le={mode:"adaptive",thresholds:y({},q),softActions:["pow-lite","js-attestation","silent-retry","token-refresh"],challengeActions:["cognitive-lite"],bunkerPolicy:{enabled:!0,ttlSeconds:900},sampling:{telemetry:.25,fullSignals:.1},privacy:{maskPII:!0},timeouts:{configMs:800,validateMs:1200,pingMs:400},ui:{showBadge:!1,showToastOnChallenge:!0},killSwitch:!1,updatedAt:"",ttlSeconds:300},L=null;function Ke(){let e=r.config.widgetPublicId||r.config.tenantId||"unknown",t=typeof window!="undefined"?window.location.hostname:"";return"hcs:cfg:"+e+":"+t}function Pt(){if(!V())return null;try{let e=localStorage.getItem(Ke());if(!e)return null;let t=JSON.parse(e);return!t.config||!t.fetchedAt?null:t}catch(e){return null}}function Bt(e){if(V())try{localStorage.setItem(Ke(),JSON.stringify(e))}catch(t){}}function Ge(e){let t=(e.config.ttlSeconds||300)*1e3;return Date.now()-e.fetchedAt<t}async function Xe(){var o,i;if(L&&Ge(L))return a("config","Using memory cache"),L.config;let e=Pt();if(e&&Ge(e))return L=e,a("config","Using localStorage cache"),e.config;let t=r.config.widgetPublicId;if(!t)return a("config","No widgetPublicId \u2014 using safe defaults"),le;let n=((i=(o=e==null?void 0:e.config)==null?void 0:o.timeouts)==null?void 0:i.configMs)||le.timeouts.configMs;try{let s=new AbortController,c=setTimeout(()=>s.abort(),n),l=r.config.apiUrl+"/api/widgets/config?widgetPublicId="+encodeURIComponent(t),d=await fetch(l,{method:"GET",signal:s.signal,headers:{"X-HCS-Widget-Version":r.config.version}});if(clearTimeout(c),!d.ok)throw new Error("HTTP "+d.status);let f=await d.json();if(!f.thresholds||typeof f.mode!="string")throw new Error("Invalid config shape");let u={config:f,fetchedAt:Date.now()};return L=u,Bt(u),a("config","Fetched remote config (mode="+f.mode+")"),f}catch(s){return x("config_fetch_failed: "+((s==null?void 0:s.message)||"unknown")),e?(a("config","Using stale localStorage cache as fallback"),L=e,e.config):(a("config","No cache \u2014 using safe defaults"),le)}}function qe(e){let t=[],n=0;e.webdriver&&(t.push("a1"),n+=50),e.plugins===0&&(t.push("a2"),n+=20);let o=["headless","phantom","selenium","puppeteer","bot","crawler","spider"],i=e.userAgent.toLowerCase();return o.some(s=>i.indexOf(s)!==-1)&&(t.push("a3"),n+=40),e.languages.length===0&&(t.push("a4"),n+=15),(e.hardwareConcurrency===0||e.hardwareConcurrency>32)&&(t.push("a5"),n+=10),(!e.canvas||e.canvas.length<5)&&(t.push("a6"),n+=25),(!e.webgl||e.webgl.length<5)&&(t.push("a7"),n+=20),e.cookieEnabled||(t.push("a8"),n+=10),(e.timezone==="UTC"||e.timezoneOffset===0)&&(t.push("a9"),n+=5),{score:Math.min(100,n),signals:t,suspicious:n>=50}}function Je(e){let t=[],n=0;return e.noMouseMovement&&e.sessionDuration>2&&(t.push("b1"),n+=15),e.linearMovement&&(t.push("b2"),n+=20),e.keystrokes===0&&e.sessionDuration>5&&(t.push("b3"),n+=5),e.microTimingEntropy>.85&&(t.push("b4"),n+=25),e.microTimingEntropy<.15&&e.sessionDuration>2&&(t.push("b5"),n+=20),e.timeToFirstInteraction<.1&&e.sessionDuration>1&&(t.push("b6"),n+=15),e.idleGaps===0&&e.sessionDuration>30&&(t.push("b7"),n+=10),e.keystrokeDwellStd<5&&e.keystrokes>10&&(t.push("b8"),n+=15),e.mouseCurvatureAvg<.001&&e.mouseMovements>20&&(t.push("b9"),n+=15),{score:Math.min(100,n),signals:t}}function Ye(){return{storageAvailable:V()&&T(),cookiesEnabled:!!navigator.cookieEnabled,cspBlocked:!1,adblockDetected:!1}}function w(e){return Math.max(0,Math.min(100,e))}function $e(e,t){var i;let n=0,o=0;for(let s of Object.keys(t)){let c=(i=e[s])!=null?i:0,l=t[s];n+=w(c)*l,o+=l}return o>0?w(n/o):0}function ue(e,t,n=.3){return e===0?t:w(n*t+(1-n)*e)}function Ze(e,t){return w(e*.4+t*.6)}function Qe(e){var c;if(typeof window=="undefined")return e;let t=((c=window.location)==null?void 0:c.hostname)||"",n=document.referrer||"",o=t==="localhost"||t==="127.0.0.1"||t==="0.0.0.0",i=n==="",s=!!window.__REACT_DEVTOOLS_GLOBAL_HOOK__||typeof window.__VUE_DEVTOOLS_GLOBAL_HOOK__!="undefined";return o||s||i?w(e*.6):e}function H(){return Math.floor(Date.now()/1e3)}function et(e){return new Promise(t=>setTimeout(t,e))}function tt(e,t=.2){let n=e*t;return e+(Math.random()*2-1)*n}var Lt={fingerprint:.25,behavior:.3,automation:.2,integrity:.1,velocity:.1,network:.05},de=0;function nt(){let e=[],t=B(),n=qe(t);e.push(...n.signals);let o=P(),i=Je(o);e.push(...i.signals);let s=0;t.webdriver&&(s+=60),n.signals.includes("a3")&&(s+=40),s=w(s);let c=Ye(),l=0;c.storageAvailable||(l+=20,e.push("i1")),c.cookiesEnabled||(l+=15,e.push("i2")),c.cspBlocked&&(l+=10,e.push("i3")),l=w(l);let d=0,f=H();de>0&&f-de<2&&(d=30,e.push("v1")),de=f;let g={fingerprint:w(n.score),behavior:w(i.score),automation:s,integrity:l,velocity:d,network:0},h=$e(g,Lt),k={total:h,components:g,reasons:e};return a("risk","Score: "+Math.round(h)+" | reasons: "+e.join(", ")),r.lastRisk=k,k}function ot(e,t){var i,s,c;let n=(i=t==null?void 0:t.thresholds)!=null?i:q,o=e.total;return t!=null&&t.killSwitch||(t==null?void 0:t.mode)==="monitor"?"allow":(s=t==null?void 0:t.bunkerPolicy)!=null&&s.enabled&&o>=n.bunker?"bunker":o<n.allow?"allow":o<n.soft?"soft":o<n.challenge?"challenge":o<n.bunker?"hard_challenge":(c=t==null?void 0:t.bunkerPolicy)!=null&&c.enabled?"bunker":"block"}function rt(){a("action","ALLOW \u2014 no friction")}function Vt(){return new Promise(e=>{let t=150+Math.random()*150,n=performance.now(),o=0,i=0;function s(){let c=performance.now()+5;for(;performance.now()<c;)o=(o<<5)-o+i|0,i++;performance.now()-n>=t?(a("soft","PoW-lite completed: "+i+" iterations in "+Math.round(performance.now()-n)+"ms"),e()):setTimeout(s,0)}s()})}function Ot(){return new Promise(e=>{let t=performance.now(),o=document.createElement("canvas").getContext("2d");o&&o.fillText("attest",0,0);let i=[typeof window.requestAnimationFrame=="function",typeof document.createTreeWalker=="function",typeof window.getComputedStyle=="function"],s=performance.now()-t;a("soft","JS attestation: "+i.filter(Boolean).length+"/3 checks, "+Math.round(s)+"ms"),e()})}async function Ft(){let e=tt(500,.3);a("soft","Silent retry in "+Math.round(e)+"ms"),await et(e)}function Ht(){a("soft","Token refresh requested")}async function J(){var t,n;let e=(n=(t=r.remoteConfig)==null?void 0:t.softActions)!=null?n:["pow-lite","js-attestation"];a("action","SOFT \u2014 executing: "+e.join(", "));for(let o of e)switch(o){case"pow-lite":await Vt();break;case"js-attestation":await Ot();break;case"silent-retry":await Ft();break;case"token-refresh":Ht();break;default:a("soft","Unknown soft action: "+o)}}var fe="hcs-challenge-overlay";async function it(e=!1){var n,o,i,s;let t=e?(o=(n=r.remoteConfig)==null?void 0:n.challengeActions)!=null?o:["cognitive-lite"]:["cognitive-lite"];a("action",(e?"HARD_":"")+"CHALLENGE \u2014 actions: "+t.join(", "));for(let c of t)switch(c){case"cognitive-lite":return me();case"voice-if-enabled":return(s=(i=r.remoteConfig)==null?void 0:i.challengeActions)!=null&&s.includes("voice-if-enabled")&&a("challenge","Voice challenge not yet implemented \u2014 falling back to cognitive-lite"),me();default:return a("challenge","Unknown challenge action: "+c),me()}return!0}function me(){return new Promise(e=>{E(fe);let t=30+Math.floor(Math.random()*40),n=5,o=Date.now(),i=m("div","position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:999999;");i.id=fe;let s=m("div","background:white;border-radius:12px;box-shadow:0 20px 25px -5px rgba(0,0,0,0.1);max-width:420px;width:90%;padding:30px;text-align:center;"),c=m("h3","margin:0 0 12px 0;color:#1e293b;font-family:system-ui,-apple-system,sans-serif;font-size:18px;","Human Verification"),l=m("p","margin:0 0 20px 0;color:#64748b;font-size:14px;font-family:system-ui,-apple-system,sans-serif;","Move the slider to "+t),d=document.createElement("input");d.type="range",d.min="0",d.max="100",d.value="0",d.style.cssText="width:100%;margin:16px 0;cursor:pointer;";let f=m("div","font-size:28px;font-weight:bold;color:#3b82f6;font-family:system-ui,-apple-system,sans-serif;margin-bottom:16px;","0"),u=m("button","padding:10px 30px;background:#3b82f6;color:white;border:none;border-radius:6px;cursor:pointer;font-size:15px;font-family:system-ui,-apple-system,sans-serif;font-weight:600;","Validate"),g=m("p","color:#cbd5e1;font-size:10px;margin-top:16px;margin-bottom:0;font-family:system-ui,-apple-system,sans-serif;","Protected by HCS-U7");d.addEventListener("input",()=>{f.textContent=d.value}),u.addEventListener("click",()=>{let h=parseInt(d.value,10),k=Math.abs(h-t)<=n,U=Date.now()-o;a("challenge","Cognitive-lite result: "+(k?"PASS":"FAIL")+" (value="+h+", target="+t+", duration="+U+"ms)"),E(fe),e(k)}),I(s,c,l,d,f,u,g),i.appendChild(s),M(i)})}var ge="hcs-bunker-overlay",Y="hcs:bunker:whitelist";function Ut(){if(!T())return!1;try{let e=sessionStorage.getItem(Y);if(!e)return!1;let t=JSON.parse(e);if(t.expiresAt>H()&&t.token)return a("bunker","Session whitelisted until "+new Date(t.expiresAt*1e3).toISOString()),!0;sessionStorage.removeItem(Y)}catch(e){}return!1}function zt(e,t){if(T())try{let n={token:e,expiresAt:H()+t};sessionStorage.setItem(Y,JSON.stringify(n))}catch(n){}}async function pe(){if(Ut()){a("bunker","Whitelisted \u2014 passing through"),r.sessionValidated=!0;return}return a("action","BUNKER \u2014 strict verification gate"),new Promise(e=>{var U,he,ye;E(ge);let t=(ye=(he=(U=r.remoteConfig)==null?void 0:U.bunkerPolicy)==null?void 0:he.ttlSeconds)!=null?ye:900,n=m("div","position:fixed;top:0;left:0;width:100%;height:100%;background:#0f172a;display:flex;align-items:center;justify-content:center;z-index:999999;font-family:system-ui,-apple-system,sans-serif;");n.id=ge;let o=m("div","text-align:center;max-width:400px;padding:40px;"),i=m("div","font-size:48px;margin-bottom:16px;","\u{1F6E1}\uFE0F"),s=m("h2","color:#f1f5f9;margin:0 0 8px 0;font-size:22px;","Security Verification Required"),c=m("p","color:#94a3b8;margin:0 0 24px 0;font-size:14px;line-height:1.5;","Enhanced security is active. Please complete the verification to continue."),l=40+Math.floor(Math.random()*20),d=3,f=m("p","color:#cbd5e1;margin:0 0 16px 0;font-size:13px;","Move the slider precisely to "+l),u=document.createElement("input");u.type="range",u.min="0",u.max="100",u.value="0",u.style.cssText="width:100%;margin:12px 0;cursor:pointer;";let g=m("div","font-size:32px;font-weight:bold;color:#60a5fa;margin-bottom:20px;","0"),h=m("button","padding:12px 36px;background:#3b82f6;color:white;border:none;border-radius:8px;cursor:pointer;font-size:15px;font-weight:600;","Verify"),k=m("p","color:#475569;font-size:10px;margin-top:24px;margin-bottom:0;","Protected by HCS-U7 Bunker Mode");u.addEventListener("input",()=>{g.textContent=u.value}),h.addEventListener("click",()=>{let ve=parseInt(u.value,10);Math.abs(ve-l)<=d?(a("bunker","Verification passed \u2014 whitelisting for "+t+"s"),zt(r.sessionToken||"bunker-pass",t),r.sessionValidated=!0,E(ge),e()):(f.textContent="Incorrect. Try again \u2014 move to "+l,f.style.color="#f87171",u.value="0",g.textContent="0",a("bunker","Verification failed (value="+ve+", target="+l+")"))}),I(o,i,s,c,f,u,g,h,k),n.appendChild(o),M(n)})}function st(){if(T())try{sessionStorage.removeItem(Y),a("bunker","Whitelist cleared (bunker exit)")}catch(e){}}function $(e){a("action","BLOCK \u2014 reason: "+e);let t=m("div","display:flex;align-items:center;justify-content:center;min-height:100vh;background:#f1f5f9;font-family:system-ui,-apple-system,sans-serif;"),n=m("div","text-align:center;max-width:500px;padding:40px;"),o=m("div","font-size:64px;margin-bottom:20px;","\u{1F6E1}\uFE0F"),i=m("h1","color:#1e293b;margin:0 0 10px 0;font-size:24px;","Access Blocked"),s=m("p","color:#64748b;margin:0 0 20px 0;font-size:15px;","Your access has been blocked by HCS-U7 Protection."),c=m("p","color:#94a3b8;font-size:13px;","Reason: "+(typeof e=="string"?e:"Unknown")),l=m("p","color:#94a3b8;font-size:11px;margin-top:30px;","Protected by HCS-U7");I(n,o,i,s,c,l),t.appendChild(n),document.body.textContent="",document.body.appendChild(t)}async function Z(e,t={}){var i;let n=r.config.apiUrl+e,o=(i=t.timeoutMs)!=null?i:1200;try{let s=new AbortController,c=setTimeout(()=>s.abort(),o),l=y({"X-HCS-Widget-Version":r.config.version},t.headers||{});t.body&&(l["Content-Type"]="application/json");let d=await fetch(n,{method:t.method||"GET",signal:s.signal,headers:l,body:t.body?JSON.stringify(t.body):void 0});return clearTimeout(c),d.ok?d.status===204?null:await d.json():(a("api","HTTP "+d.status+" from "+e),null)}catch(s){return(s==null?void 0:s.name)==="AbortError"?x("Timeout ("+o+"ms) on "+e):a("api","Fetch error on "+e+": "+((s==null?void 0:s.message)||"unknown")),null}}function Nt(e){let t=e.fingerprint;return y(y(y({f:{ua:S(t.userAgent),l:t.language,p:S(t.platform),hc:t.hardwareConcurrency,sr:t.screenResolution,cd:t.colorDepth,tz:t.timezoneOffset,wd:t.webdriver,pl:t.plugins,cv:t.canvas,gl:t.webgl,ts:t.touchSupport,ck:t.cookieEnabled},bs:{s:e.botSignals.score,r:e.botSignals.signals.map(ee)},bh:{nm:e.behavior.noMouseMovement,lm:e.behavior.linearMovement,ks:e.behavior.keystrokes,mt:Math.round(e.behavior.microTimingEntropy*100),ti:Math.round(e.behavior.timeToFirstInteraction*100),ig:e.behavior.idleGaps,sd:Math.round(e.behavior.sessionDuration),mc:Math.round(e.behavior.mouseCurvatureAvg*1e3),mm:e.behavior.mouseMovements},rb:{t:Math.round(e.riskBreakdown.total),c:Object.fromEntries(Object.entries(e.riskBreakdown.components).map(([n,o])=>[n[0],Math.round(o)])),r:e.riskBreakdown.reasons.map(ee)},u:S(e.url),rf:S(e.referrer)},e.token?{tk:e.token}:{}),e.tenantId?{ti:e.tenantId}:{}),e.widgetPublicId?{wp:e.widgetPublicId}:{})}async function at(e){var l,d,f,u;let t=r.config,n=(f=(d=(l=r.remoteConfig)==null?void 0:l.timeouts)==null?void 0:d.validateMs)!=null?f:1200,o={fingerprint:B(),botSignals:{score:e.components.fingerprint,signals:e.reasons},behavior:P(),riskBreakdown:e,url:Se(),referrer:Ee()};t.token?o.token=t.token:t.tenantId&&(o.tenantId=t.tenantId),t.widgetPublicId&&(o.widgetPublicId=t.widgetPublicId);let i=Nt(o),s=De(i),c=await Z("/widget/validate",{method:"POST",body:{_e:s,_v:3},timeoutMs:n});return c?(a("validate","Server response: action="+c.action+" serverRisk="+((u=c.serverRisk)!=null?u:"n/a")),c.token&&(r.sessionToken=c.token),{action:c.action,token:c.token,expiresIn:c.expiresIn,serverRisk:c.serverRisk,flags:c.flags,reason:c.reason,score:c.score}):(a("validate","Backend unreachable \u2014 degraded mode"),r.degraded=!0,{action:"allow",reason:"api_unreachable",score:0})}async function ct(){var t,n,o,i,s,c;if(r.sessionValidated)return a("decision","Already validated this session"),(t=r.lastDecision)!=null?t:"allow";((o=(n=r.remoteConfig)==null?void 0:n.mode)!=null?o:"adaptive")!=="enforce"&&r.bunkerActive&&(a("decision","Bunker exit detected \u2014 resetting bunker state"),r.bunkerActive=!1,r.sessionToken=null,r.emaScore=0,st());try{let l=nt();l.total=Qe(l.total),r.emaScore=ue(r.emaScore,l.total,.3),l.total=r.emaScore;let d=await at(l);if(!d||d.reason==="api_unreachable")return a("decision","API unreachable \u2014 monitor-only mode (soft actions only)"),r.degraded=!0,r.lastDecision="soft",r.lastSeen=Date.now(),await J(),r.sessionValidated=!0,"soft";let f=l.total;if(d.serverRisk!==void 0&&(f=Ze(l.total,d.serverRisk),r.emaScore=ue(r.emaScore,f,.3),f=r.emaScore,l.total=f),d.action==="block")return r.lastDecision="block",r.lastValidation=d,$(d.reason||"Server decision"),"block";if(d.action==="bunker"&&((s=(i=r.remoteConfig)==null?void 0:i.bunkerPolicy)!=null&&s.enabled))return r.lastDecision="bunker",r.lastValidation=d,r.bunkerActive=!0,await pe(),"bunker";let u=ot(l,r.remoteConfig),g=(c=r.remoteConfig)==null?void 0:c.thresholds;switch(r.lastDecision==="allow"&&(u==="challenge"||u==="hard_challenge")&&g&&f<g.challenge+5&&(a("decision","Hysteresis: suppressing escalation allow\u2192"+u+" (score "+Math.round(f)+" < challenge+5)"),u="soft"),r.lastDecision==="soft"&&(u==="challenge"||u==="hard_challenge")&&g&&f<g.challenge+3&&(a("decision","Hysteresis: suppressing escalation soft\u2192"+u),u="soft"),r.lastDecision=u,r.lastValidation=d,r.lastSeen=Date.now(),d.token&&(r.sessionToken=d.token),u==="bunker"&&(r.bunkerActive=!0),a("decision","Decision: "+u+" (score: "+Math.round(f)+", ema: "+Math.round(r.emaScore)+")"),u){case"allow":rt(),r.sessionValidated=!0;break;case"soft":await J(),r.sessionValidated=!0;break;case"challenge":case"hard_challenge":if(await it(u==="hard_challenge"))r.sessionValidated=!0;else return $("Challenge failed"),r.lastDecision="block","block";break;case"bunker":await pe();break;case"block":$("Risk threshold exceeded");break}return u}catch(l){return a("decision","Pipeline error \u2014 monitor-only fail-safe: "+((l==null?void 0:l.message)||"unknown")),r.degraded=!0,r.lastDecision="soft",r.sessionValidated=!0,await J(),"soft"}}var lt=new Map;function ut(e,t,n){let o=Date.now(),i=lt.get(e);return(!i||o>=i.resetAt)&&(i={count:0,resetAt:o+n},lt.set(e,i)),i.count>=t?!1:(i.count++,!0)}async function dt(){var o,i,s;let e=r.config.widgetPublicId;if(!e)return;if(!ut("ping",1,3e4)){a("ping","Rate limited \u2014 skipping");return}let t=(s=(i=(o=r.remoteConfig)==null?void 0:o.timeouts)==null?void 0:i.pingMs)!=null?s:400;if(!await Z("/api/widgets/ping",{method:"POST",body:{widgetPublicId:e},timeoutMs:t})&&typeof document!="undefined")try{let c=r.config.apiUrl+"/api/widgets/ping.gif?widgetPublicId="+encodeURIComponent(e)+"&_="+Date.now(),l=new Image;l.src=c}catch(c){}a("ping","Sent")}var ft="hcs-debug-badge",mt="hcs-debug-score";function gt(){var o,i;if(!F()||!((i=(o=r.remoteConfig)==null?void 0:o.ui)!=null&&i.showBadge)&&!r.config.debug)return;E(ft);let e=m("div","position:fixed;bottom:10px;right:10px;background:rgba(30,41,59,0.8);color:#e2e8f0;padding:6px 12px;border-radius:8px;font-family:system-ui,-apple-system,sans-serif;font-size:11px;z-index:999998;cursor:pointer;user-select:none;backdrop-filter:blur(4px);border:1px solid rgba(148,163,184,0.2);");e.id=ft;let t=m("span","font-weight:600;","\u{1F6E1}\uFE0F HCS Debug "),n=m("span","margin-left:4px;","...");n.id=mt,e.appendChild(t),e.appendChild(n),e.addEventListener("click",()=>{var s;console.group("[HCS-U7] Debug Details"),console.log("Version:",r.config.version),console.log("Decision:",r.lastDecision),console.log("Risk:",r.lastRisk),console.log("Validation:",r.lastValidation),console.log("Degraded:",r.degraded),console.log("Remote config:",(s=r.remoteConfig)==null?void 0:s.mode),console.groupEnd()}),M(e)}function pt(e,t){if(!F())return;let n=document.getElementById(mt);if(!n)return;let o=t==="allow"?"#4ade80":t==="soft"?"#a3e635":t==="challenge"||t==="hard_challenge"?"#fbbf24":t==="bunker"?"#f97316":"#f87171",i=t==="allow"?"\u2705":t==="soft"?"\u{1F7E2}":t==="challenge"||t==="hard_challenge"?"\u26A0\uFE0F":t==="bunker"?"\u{1F6E1}\uFE0F":"\u274C";n.textContent=i+" "+Math.round(e),n.style.color=o}var Q="3.0.0";xe()&&(je(),Wt());async function Wt(){var e,t;if(Ie()){r.config.version=Q,a("boot","Widget v"+Q+" booting");try{if(r.remoteConfig=await Xe(),a("boot","Remote config loaded (mode="+r.remoteConfig.mode+")"),r.remoteConfig.killSwitch){a("boot","Kill switch active \u2014 monitor only"),r.ready=!0,be();return}}catch(n){a("boot","Remote config failed \u2014 using safe defaults"),r.degraded=!0}(t=(e=r.remoteConfig)==null?void 0:e.ui)!=null&&t.showBadge&&R(!0),jt(),gt(),dt().catch(()=>{}),ne(async()=>{var n,o;try{let i=await ct();pt((o=(n=r.lastRisk)==null?void 0:n.total)!=null?o:0,i),r.ready=!0,r.lastSeen=Date.now(),be(),a("boot","Boot complete \u2014 decision: "+i)}catch(i){x("Boot decision failed: "+((i==null?void 0:i.message)||"unknown")),r.degraded=!0,r.ready=!0,be()}})}}function be(){let e={ready:r.ready,lastDecision:r.lastDecision,lastSeen:r.lastSeen,version:Q,degraded:r.degraded};try{Object.defineProperty(window,"HCS_STATUS",{value:Object.freeze(e),writable:!1,configurable:!0,enumerable:!0})}catch(t){window.HCS_STATUS=e}}function jt(){var n,o,i;if(window.__HCS_DEBUG__===!0&&R(!0),!F())return;let e=r.config;if(!(((n=e.tokenPayload)==null?void 0:n.dbg)||!e.token)){a("debug","Debug requested but not authorized by token"),R(!1);return}window.__HCS_DEBUG__=Object.freeze({version:Q,tenantId:O(e.tenantId),mode:(i=(o=r.remoteConfig)==null?void 0:o.mode)!=null?i:"unknown",env:e.env,getFingerprint:()=>B(),getBehavior:()=>P(),getLogs:()=>Ae(),getRisk:()=>r.lastRisk?y({},r.lastRisk):null,getDecision:()=>r.lastDecision,getConfig:()=>r.remoteConfig?y({},r.remoteConfig):null,isDegraded:()=>r.degraded,getStatus:()=>{var s,c,l,d;return{riskScore:Math.round(r.emaScore),decision:r.lastDecision,thresholds:(c=(s=r.remoteConfig)==null?void 0:s.thresholds)!=null?c:null,mode:(d=(l=r.remoteConfig)==null?void 0:l.mode)!=null?d:"unknown",bunkerActive:r.bunkerActive,degraded:r.degraded,sessionValidated:r.sessionValidated}}}),a("debug","Debug API exposed on window.__HCS_DEBUG__")}})();
