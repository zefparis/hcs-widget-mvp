/**
 * HCS-U7 Widget v3.0.0 — Enterprise Adaptive Engine
 * Copyright (c) 2025-2026 Benjamin BARRERE / IA SOLUTION
 * Patents Pending FR2514274 | FR2514546
 * Built: 2026-02-17T16:15:10.440Z
 * DO NOT EDIT — generated from src/widget-v3/
 */
"use strict";(()=>{var Tt=Object.defineProperty;var Be=Object.getOwnPropertySymbols;var It=Object.prototype.hasOwnProperty,Rt=Object.prototype.propertyIsEnumerable;var _e=(e,t,n)=>t in e?Tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,k=(e,t)=>{for(var n in t||(t={}))It.call(t,n)&&_e(e,n,t[n]);if(Be)for(var n of Be(t))Rt.call(t,n)&&_e(e,n,t[n]);return e};function Le(){return typeof window!="undefined"&&typeof document!="undefined"}function Ve(){try{return window.location.href}catch(e){return""}}function Oe(){try{return document.referrer}catch(e){return""}}function H(){try{let e="__hcs_test__";return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch(e){return!1}}function I(){try{let e="__hcs_test__";return sessionStorage.setItem(e,"1"),sessionStorage.removeItem(e),!0}catch(e){return!1}}var Pt="https://api.hcs-u7.org",i={config:{apiUrl:Pt,version:"3.0.0",debug:!1,env:"production",token:null,tenantId:null,widgetPublicId:null,tokenPayload:null},remoteConfig:null,sessionValidated:!1,sessionToken:null,lastDecision:null,lastRisk:null,lastValidation:null,lastSeen:0,degraded:!1,ready:!1,bunkerActive:!1,emaScore:0};function E(e){let t=5381;for(let n=0;n<e.length;n++)t=(t<<5)+t+e.charCodeAt(n)|0;return Math.abs(t).toString(36)}function Bt(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=t*16777619|0;return t>>>0}function He(e){try{let n=(e+"====".substring(0,(4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent(atob(n).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join(""))}catch(t){return null}}function F(e){return!e||e.length<8?"***":e.substring(0,4)+"..."+e.substring(e.length-3)}function Fe(e){let t=JSON.stringify(e),n=90,o=new Uint8Array(t.length);for(let s=0;s<t.length;s++)o[s]=t.charCodeAt(s)^n;let r="";for(let s=0;s<o.length;s++)r+=String.fromCharCode(o[s]);return btoa(r)}function re(e){return"s"+Bt(e).toString(36)}var N=[],ie=!1;function R(e){ie=e}function U(){return ie}function c(e,t){if(!ie)return;let n={t:Date.now(),cat:e,data:t};N.push(n),N.length>200&&N.shift(),console.debug("[HCS-U7]["+e+"]",t)}function A(e){console.error("[HCS-U7] "+e)}function Ue(){return N.slice()}function ze(e){if(!e||typeof e!="string")return null;let t=e.split(".");if(t.length!==2)return null;let n=He(t[0]);if(!n)return null;try{let o=JSON.parse(n);return!o.tid||!o.exp||!o.v?null:o}catch(o){return null}}function Xe(e){return!e||e.includes(".")?!1:!!(/^[0-9a-f]{8}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{12}$/i.test(e)||/^c[a-z0-9]{20,30}$/.test(e))}function Ne(){let e=i.config,t=document.querySelectorAll('script[data-widget], script[data-tenant], script[src*="hcs-widget"]'),n=null;for(let o=0;o<t.length;o++)if(t[o].getAttribute("data-widget")||t[o].getAttribute("data-tenant")||(t[o].getAttribute("src")||"").indexOf("hcs-widget")!==-1){n=t[o];break}if(n&&n.getAttribute("data-widget")){e.widgetPublicId=n.getAttribute("data-widget");let o=n.getAttribute("data-tenant");if(o)if(Xe(o))e.tenantId=o;else{let r=ze(o);r&&(e.token=o,e.tokenPayload=r,e.tenantId=r.tid)}c("init","Widget public ID from data-widget")}else if(n&&n.getAttribute("data-tenant")){let o=n.getAttribute("data-tenant");if(Xe(o))e.tenantId=o,e.token=null,c("init","Legacy tenant ID from data-tenant");else{let r=ze(o);if(r)e.token=o,e.tokenPayload=r,e.tenantId=r.tid,r.dbg&&(e.debug=!0),r.env&&(e.env=r.env),c("init","Signed token parsed, tenant: "+F(r.tid));else return A("Invalid data-tenant token format"),!1}}else if(window.HCS_TENANT_ID)e.tenantId=window.HCS_TENANT_ID,e.token=null,c("init","Legacy window.HCS_TENANT_ID mode");else return A("Missing data-widget, data-tenant, or window.HCS_TENANT_ID"),!1;return n&&(n.getAttribute("data-debug")==="true"&&(e.debug=!0),n.getAttribute("data-env")&&(e.env=n.getAttribute("data-env")),n.getAttribute("data-api")&&(e.apiUrl=n.getAttribute("data-api"))),R(e.debug),c("init","Widget v"+e.version+" | tenant: "+F(e.tenantId)+" | mode: "+(e.token?"signed_token":"legacy")),!0}function g(e,t,n){let o=document.createElement(e);return o.style.cssText=t,n!==void 0&&(o.textContent=n),o}function P(e,...t){for(let n of t)e.appendChild(n)}function D(e){let t=document.getElementById(e);t&&t.remove()}function se(e){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()}function B(e){document.body?document.body.appendChild(e):se(()=>document.body.appendChild(e))}var W=0,j=null,le=0,Ge=0,v=[],C=[],G=[],ue=[],Ke=0,_={},K=[],q=[],Y=[],de=0,qe=0,Ye=0,fe=[],We=0,ae=0,Je=0,ce=0,Ze=0,$e=[],Qe=[],w=[],M=[],J=[],ge=[],Z=[],me=new Map,pe=[],he=[],be=[],ve=[],ye=[],ke=[],et=0,tt=0,x=[];function b(e){if(!e.length)return 0;let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}function h(e){if(e.length<2)return 0;let t=b(e),n=0;for(let o=0;o<e.length;o++)n+=(e[o]-t)*(e[o]-t);return Math.sqrt(n/(e.length-1))}function xe(e,t,n){let o=t.x-e.x,r=t.y-e.y,s=n.x-t.x,a=n.y-t.y,u=Math.abs(o*a-r*s),d=Math.sqrt(o*o+r*r),f=Math.sqrt(s*s+a*a),l=n.x-e.x,m=n.y-e.y,p=Math.sqrt(l*l+m*m),y=d*f*p;return y===0?0:2*u/y}function nt(e){if(e.length<5)return .5;let t=[];for(let l=1;l<e.length;l++)t.push(e[l]-e[l-1]);let n=20,o=1/0,r=-1/0;for(let l of t)l<o&&(o=l),l>r&&(r=l);let s=r-o;if(s===0)return 0;let a=new Array(n).fill(0);for(let l of t)a[Math.min(Math.floor((l-o)/s*n),n-1)]++;let u=0,d=t.length;for(let l of a)if(l>0){let m=l/d;u-=m*Math.log2(m)}let f=Math.log2(n);return f>0?u/f:0}function _t(e){if(e.length<3)return 0;let t=b(e),n=h(e);if(n===0)return 0;let o=e.length,r=0;for(let s of e)r+=Math.pow((s-t)/n,3);return o/((o-1)*(o-2))*r}function Lt(e){if(e.length<4)return 3;let t=b(e),n=h(e);if(n===0)return 0;let o=0;for(let r of e)o+=Math.pow((r-t)/n,4);return o/e.length-3}function Vt(){if(v.length<10)return!1;let e=v.slice(-50),t=0,n=0;for(let o=2;o<e.length;o++)n++,xe(e[o-2],e[o-1],e[o])<.001&&t++;return n>0&&t/n>.8}function Ot(){if(x.length<10)return .5;let e=[];for(let o=1;o<x.length;o++)e.push(x[o]-x[o-1]);let t=0;if(e.length>2){let o=b(e),r=h(e);if(r>0){let s=0;for(let a=1;a<e.length;a++)s+=(e[a]-o)/r*((e[a-1]-o)/r);t=s/(e.length-1)}}let n=nt(x);return n>.85&&Math.abs(t)<.1?.9:n<.15?.1:n}function T(){let e=Date.now();j===null&&(j=e),e-le>3e3&&Ge++,le=e,x.length<500&&x.push(e)}function Ht(e){T();let t={x:e.clientX,y:e.clientY,t:performance.now()};if(v.length>0){let n=v[v.length-1],o=t.t-n.t;if(o>0){let r=t.x-n.x,s=t.y-n.y,u=Math.sqrt(r*r+s*s)/o;if(C.length<500&&C.push(u),C.length>=2){let d=C[C.length-2];G.length<500&&G.push((u-d)/o)}if(v.length>=2){let d=v[v.length-2];ue.length<500&&ue.push(xe(d,n,t))}}}v.length<500?v.push(t):v[v.length-1]=t}function Ft(){T(),Ke++}function Ut(e){if(T(),["Shift","Control","Alt","Meta"].indexOf(e.key)!==-1)return;let t=performance.now();if(de>0){let o=t-de;o>0&&o<5e3&&Y.length<500&&Y.push(o)}let n=Object.keys(_);if(n.length>0&&K.length<500){let o=0;for(let s of n)_[s]>o&&(o=_[s]);let r=t-o;r>0&&r<5e3&&K.push(r)}_[e.code]=t,qe++}function zt(e){if(["Shift","Control","Alt","Meta"].indexOf(e.key)!==-1)return;let t=performance.now(),n=_[e.code];if(n!==void 0){let o=t-n;o>0&&o<2e3&&q.length<500&&q.push(o),delete _[e.code]}de=t}function Xt(){T(),Ye++;let e=performance.now(),t=window.scrollY||document.documentElement.scrollTop,n=e-ae;if(n>0&&ae>0){let o=t-We;fe.length<500&&fe.push(Math.abs(o)/n);let r=o>0?1:o<0?-1:0;r!==0&&r!==ce&&ce!==0&&Je++,r!==0&&(ce=r)}We=t,ae=e}function Nt(e){T(),Ze++;let t=performance.now();for(let n=0;n<e.touches.length;n++){let o=e.touches[n];o.force!==void 0&&o.force>0&&$e.push(o.force),o.radiusX!==void 0&&Qe.push((o.radiusX+o.radiusY)/2),me.set(o.identifier,t)}}function Wt(e){T();for(let t=0;t<e.changedTouches.length;t++){let n=e.changedTouches[t],o={x:n.clientX,y:n.clientY,t:performance.now()};if(w.length>0){let r=w[w.length-1],s=o.t-r.t;if(s>0){let a=o.x-r.x,u=o.y-r.y,f=Math.sqrt(a*a+u*u)/s;if(M.length<500&&M.push(f),M.length>=2){let l=M[M.length-2];J.length<500&&J.push((f-l)/s)}if(w.length>=2){let l=w[w.length-2];ge.length<500&&ge.push(xe(l,r,o))}}}w.length<500?w.push(o):w[w.length-1]=o}}function jt(e){let t=performance.now();for(let n=0;n<e.changedTouches.length;n++){let o=e.changedTouches[n],r=me.get(o.identifier);if(r!==void 0){let s=t-r;s>0&&s<1e4&&Z.length<500&&Z.push(s),me.delete(o.identifier)}}}function Gt(e){et++;let t=e.accelerationIncludingGravity;t&&(t.x!==null&&ve.length<500&&ve.push(t.x),t.y!==null&&ye.length<500&&ye.push(t.y),t.z!==null&&ke.length<500&&ke.push(t.z))}function Kt(e){e.alpha!==null&&pe.length<500&&pe.push(e.alpha),e.beta!==null&&he.length<500&&he.push(e.beta),e.gamma!==null&&be.length<500&&be.push(e.gamma)}function je(){T(),tt++}function ot(){W=Date.now(),le=W;let e={passive:!0};document.addEventListener("mousemove",Ht,e),document.addEventListener("click",Ft,e),document.addEventListener("keydown",Ut,e),document.addEventListener("keyup",zt,e),document.addEventListener("scroll",Xt,{passive:!0,capture:!0}),document.addEventListener("touchstart",Nt,e),document.addEventListener("touchmove",Wt,e),document.addEventListener("touchend",jt,e),window.addEventListener("devicemotion",Gt,e),window.addEventListener("deviceorientation",Kt,e),document.addEventListener("copy",je,e),document.addEventListener("paste",je,e)}function L(){let t=(Date.now()-W)/1e3,n=[];for(let o=1;o<x.length;o++)n.push(x[o]-x[o-1]);return{keystrokeIntervalAvg:b(K),keystrokeIntervalStd:h(K),keystrokeDwellAvg:b(q),keystrokeDwellStd:h(q),keystrokes:qe,flightTimeAvg:b(Y),flightTimeStd:h(Y),mouseVelocityAvg:b(C),mouseVelocityStd:h(C),mouseAccelerationAvg:b(G),mouseAccelerationStd:h(G),mouseCurvatureAvg:b(ue),mouseMovements:v.length,mouseClicks:Ke,noMouseMovement:v.length===0,linearMovement:Vt(),scrollEvents:Ye,scrollVelocityAvg:b(fe),scrollDirectionChanges:Je,touchEvents:Ze,touchPressureAvg:b($e),touchRadiusAvg:b(Qe),touchVelocityAvg:b(M),touchVelocityStd:h(M),touchAccelerationAvg:b(J),touchAccelerationStd:h(J),touchCurvatureAvg:b(ge),touchHoldDurationAvg:b(Z),touchHoldDurationStd:h(Z),gyroAlphaStd:h(pe),gyroBetaStd:h(he),gyroGammaStd:h(be),accelXStd:h(ve),accelYStd:h(ye),accelZStd:h(ke),deviceMotionEvents:et,timeToFirstInteraction:j?(j-W)/1e3:t,sessionDuration:t,idleGaps:Ge,timingEntropy:nt(x),copyPasteEvents:tt,pageViews:1,microTimingEntropy:Ot(),timingDistributionSkewness:_t(n),timingDistributionKurtosis:Lt(n)}}function V(){let e=navigator;return{userAgent:e.userAgent||"",language:e.language||"",languages:e.languages||[],platform:e.platform||"",hardwareConcurrency:e.hardwareConcurrency||0,deviceMemory:e.deviceMemory||null,screenResolution:screen.width+"x"+screen.height,colorDepth:screen.colorDepth||0,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timezoneOffset:new Date().getTimezoneOffset(),webdriver:!!e.webdriver,plugins:e.plugins?e.plugins.length:0,canvas:qt(),webgl:Yt(),touchSupport:"ontouchstart"in window,cookieEnabled:!!e.cookieEnabled,doNotTrack:e.doNotTrack||null,timestamp:Date.now()}}function qt(){try{let e=document.createElement("canvas"),t=e.getContext("2d");return t?(e.width=200,e.height=50,t.textBaseline="top",t.font="14px Arial",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText("HCS-U7",2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText("HCS-U7",4,17),E(e.toDataURL())):""}catch(e){return""}}function Yt(){try{let e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return"";let n=t.getExtension("WEBGL_debug_renderer_info");if(!n)return"";let o=t.getParameter(n.UNMASKED_VENDOR_WEBGL),r=t.getParameter(n.UNMASKED_RENDERER_WEBGL);return E(o+"~"+r)}catch(e){return""}}var $={allow:30,soft:55,challenge:80,bunker:95};var we={mode:"adaptive",thresholds:k({},$),softActions:["pow-lite","js-attestation","silent-retry","token-refresh"],challengeActions:["cognitive-lite"],bunkerPolicy:{enabled:!0,ttlSeconds:900},sampling:{telemetry:.25,fullSignals:.1},privacy:{maskPII:!0},timeouts:{configMs:4e3,validateMs:5e3,pingMs:2e3},ui:{showBadge:!1,showToastOnChallenge:!0},killSwitch:!1,updatedAt:"",ttlSeconds:300},O=null;function it(){let e=i.config.widgetPublicId||i.config.tenantId||"unknown",t=typeof window!="undefined"?window.location.hostname:"";return"hcs:cfg:"+e+":"+t}function Jt(){if(!H())return null;try{let e=localStorage.getItem(it());if(!e)return null;let t=JSON.parse(e);return!t.config||!t.fetchedAt?null:t}catch(e){return null}}function Zt(e){if(H())try{localStorage.setItem(it(),JSON.stringify(e))}catch(t){}}function rt(e){let t=(e.config.ttlSeconds||300)*1e3;return Date.now()-e.fetchedAt<t}async function st(){var r,s;if(O&&rt(O))return c("config","Using memory cache"),O.config;let e=Jt();if(e&&rt(e))return O=e,c("config","Using localStorage cache"),e.config;let t=i.config.widgetPublicId,n=i.config.tenantId;if(!t&&!n)return c("config","No widgetPublicId or tenantId \u2014 using safe defaults"),we;let o=((s=(r=e==null?void 0:e.config)==null?void 0:r.timeouts)==null?void 0:s.configMs)||we.timeouts.configMs;try{let a=new AbortController,u=setTimeout(()=>a.abort(),o),d=t?"widgetPublicId="+encodeURIComponent(t):"tenantId="+encodeURIComponent(n),f=i.config.apiUrl+"/api/widgets/config?"+d,l=await fetch(f,{method:"GET",signal:a.signal,headers:{"X-HCS-Widget-Version":i.config.version}});if(clearTimeout(u),!l.ok)throw new Error("HTTP "+l.status);let m=await l.json();m.widgetPublicId&&!i.config.widgetPublicId&&(i.config.widgetPublicId=m.widgetPublicId,c("config","Resolved widgetPublicId from backend: "+m.widgetPublicId.slice(0,6)+"..."));let p=m.config||m;if(!p.thresholds||typeof p.mode!="string")throw new Error("Invalid config shape");let y={config:p,fetchedAt:Date.now()};return O=y,Zt(y),c("config","Fetched remote config (mode="+p.mode+")"),p}catch(a){return A("config_fetch_failed: "+((a==null?void 0:a.message)||"unknown")),e?(c("config","Using stale localStorage cache as fallback"),O=e,e.config):(c("config","No cache \u2014 using safe defaults"),we)}}function at(e){let t=[],n=0;e.webdriver&&(t.push("a1"),n+=50),e.plugins===0&&(t.push("a2"),n+=20);let o=["headless","phantom","selenium","puppeteer","bot","crawler","spider"],r=e.userAgent.toLowerCase();return o.some(s=>r.indexOf(s)!==-1)&&(t.push("a3"),n+=40),e.languages.length===0&&(t.push("a4"),n+=15),(e.hardwareConcurrency===0||e.hardwareConcurrency>32)&&(t.push("a5"),n+=10),(!e.canvas||e.canvas.length<5)&&(t.push("a6"),n+=25),(!e.webgl||e.webgl.length<5)&&(t.push("a7"),n+=20),e.cookieEnabled||(t.push("a8"),n+=10),(e.timezone==="UTC"||e.timezoneOffset===0)&&(t.push("a9"),n+=5),{score:Math.min(100,n),signals:t,suspicious:n>=50}}function ct(e){let t=[],n=0;return e.noMouseMovement&&e.sessionDuration>2&&(t.push("b1"),n+=15),e.linearMovement&&(t.push("b2"),n+=20),e.keystrokes===0&&e.sessionDuration>5&&(t.push("b3"),n+=5),e.microTimingEntropy>.85&&(t.push("b4"),n+=25),e.microTimingEntropy<.15&&e.sessionDuration>2&&(t.push("b5"),n+=20),e.timeToFirstInteraction<.1&&e.sessionDuration>1&&(t.push("b6"),n+=15),e.idleGaps===0&&e.sessionDuration>30&&(t.push("b7"),n+=10),e.keystrokeDwellStd<5&&e.keystrokes>10&&(t.push("b8"),n+=15),e.mouseCurvatureAvg<.001&&e.mouseMovements>20&&(t.push("b9"),n+=15),{score:Math.min(100,n),signals:t}}function lt(){return{storageAvailable:H()&&I(),cookiesEnabled:!!navigator.cookieEnabled,cspBlocked:!1,adblockDetected:!1}}function S(e){return Math.max(0,Math.min(100,e))}function ut(e,t){var r;let n=0,o=0;for(let s of Object.keys(t)){let a=(r=e[s])!=null?r:0,u=t[s];n+=S(a)*u,o+=u}return o>0?S(n/o):0}function Se(e,t,n=.3){return e===0?t:S(n*t+(1-n)*e)}function dt(e,t){return S(e*.4+t*.6)}function ft(e){var a;if(typeof window=="undefined")return e;let t=((a=window.location)==null?void 0:a.hostname)||"",n=document.referrer||"",o=t==="localhost"||t==="127.0.0.1"||t==="0.0.0.0",r=n==="",s=!!window.__REACT_DEVTOOLS_GLOBAL_HOOK__||typeof window.__VUE_DEVTOOLS_GLOBAL_HOOK__!="undefined";return o||s||r?S(e*.6):e}function z(){return Math.floor(Date.now()/1e3)}function gt(e){return new Promise(t=>setTimeout(t,e))}function mt(e,t=.2){let n=e*t;return e+(Math.random()*2-1)*n}var $t={fingerprint:.25,behavior:.3,automation:.2,integrity:.1,velocity:.1,network:.05},Ae=0;function pt(){let e=[],t=V(),n=at(t);e.push(...n.signals);let o=L(),r=ct(o);e.push(...r.signals);let s=0;t.webdriver&&(s+=60),n.signals.includes("a3")&&(s+=40),s=S(s);let a=lt(),u=0;a.storageAvailable||(u+=20,e.push("i1")),a.cookiesEnabled||(u+=15,e.push("i2")),a.cspBlocked&&(u+=10,e.push("i3")),u=S(u);let d=0,f=z();Ae>0&&f-Ae<2&&(d=30,e.push("v1")),Ae=f;let m={fingerprint:S(n.score),behavior:S(r.score),automation:s,integrity:u,velocity:d,network:0},p=ut(m,$t),y={total:p,components:m,reasons:e};return c("risk","Score: "+Math.round(p)+" | reasons: "+e.join(", ")),i.lastRisk=y,y}function ht(e,t){var r,s,a;let n=(r=t==null?void 0:t.thresholds)!=null?r:$,o=e.total;return t!=null&&t.killSwitch||(t==null?void 0:t.mode)==="monitor"?"allow":(s=t==null?void 0:t.bunkerPolicy)!=null&&s.enabled&&o>=n.bunker?"bunker":o<n.allow?"allow":o<n.soft?"soft":o<n.challenge?"challenge":o<n.bunker?"hard_challenge":(a=t==null?void 0:t.bunkerPolicy)!=null&&a.enabled?"bunker":"block"}function bt(){c("action","ALLOW \u2014 no friction")}function Qt(){return new Promise(e=>{let t=150+Math.random()*150,n=performance.now(),o=0,r=0;function s(){let a=performance.now()+5;for(;performance.now()<a;)o=(o<<5)-o+r|0,r++;performance.now()-n>=t?(c("soft","PoW-lite completed: "+r+" iterations in "+Math.round(performance.now()-n)+"ms"),e()):setTimeout(s,0)}s()})}function en(){return new Promise(e=>{let t=performance.now(),o=document.createElement("canvas").getContext("2d");o&&o.fillText("attest",0,0);let r=[typeof window.requestAnimationFrame=="function",typeof document.createTreeWalker=="function",typeof window.getComputedStyle=="function"],s=performance.now()-t;c("soft","JS attestation: "+r.filter(Boolean).length+"/3 checks, "+Math.round(s)+"ms"),e()})}async function tn(){let e=mt(500,.3);c("soft","Silent retry in "+Math.round(e)+"ms"),await gt(e)}function nn(){c("soft","Token refresh requested")}async function Q(){var t,n;let e=(n=(t=i.remoteConfig)==null?void 0:t.softActions)!=null?n:["pow-lite","js-attestation"];c("action","SOFT \u2014 executing: "+e.join(", "));for(let o of e)switch(o){case"pow-lite":await Qt();break;case"js-attestation":await en();break;case"silent-retry":await tn();break;case"token-refresh":nn();break;default:c("soft","Unknown soft action: "+o)}}var Ee="hcs-challenge-overlay";async function vt(e=!1){var n,o,r,s;let t=e?(o=(n=i.remoteConfig)==null?void 0:n.challengeActions)!=null?o:["cognitive-lite"]:["cognitive-lite"];c("action",(e?"HARD_":"")+"CHALLENGE \u2014 actions: "+t.join(", "));for(let a of t)switch(a){case"cognitive-lite":return De();case"voice-if-enabled":return(s=(r=i.remoteConfig)==null?void 0:r.challengeActions)!=null&&s.includes("voice-if-enabled")&&c("challenge","Voice challenge not yet implemented \u2014 falling back to cognitive-lite"),De();default:return c("challenge","Unknown challenge action: "+a),De()}return!0}function De(){return new Promise(e=>{D(Ee);let t=30+Math.floor(Math.random()*40),n=5,o=Date.now(),r=g("div","position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:999999;");r.id=Ee;let s=g("div","background:white;border-radius:12px;box-shadow:0 20px 25px -5px rgba(0,0,0,0.1);max-width:420px;width:90%;padding:30px;text-align:center;"),a=g("h3","margin:0 0 12px 0;color:#1e293b;font-family:system-ui,-apple-system,sans-serif;font-size:18px;","Human Verification"),u=g("p","margin:0 0 20px 0;color:#64748b;font-size:14px;font-family:system-ui,-apple-system,sans-serif;","Move the slider to "+t),d=document.createElement("input");d.type="range",d.min="0",d.max="100",d.value="0",d.style.cssText="width:100%;margin:16px 0;cursor:pointer;";let f=g("div","font-size:28px;font-weight:bold;color:#3b82f6;font-family:system-ui,-apple-system,sans-serif;margin-bottom:16px;","0"),l=g("button","padding:10px 30px;background:#3b82f6;color:white;border:none;border-radius:6px;cursor:pointer;font-size:15px;font-family:system-ui,-apple-system,sans-serif;font-weight:600;","Validate"),m=g("p","color:#cbd5e1;font-size:10px;margin-top:16px;margin-bottom:0;font-family:system-ui,-apple-system,sans-serif;","Protected by HCS-U7");d.addEventListener("input",()=>{f.textContent=d.value}),l.addEventListener("click",()=>{let p=parseInt(d.value,10),y=Math.abs(p-t)<=n,X=Date.now()-o;c("challenge","Cognitive-lite result: "+(y?"PASS":"FAIL")+" (value="+p+", target="+t+", duration="+X+"ms)"),D(Ee),e(y)}),P(s,a,u,d,f,l,m),r.appendChild(s),B(r)})}var Ce="hcs-bunker-overlay",ee="hcs:bunker:whitelist";function on(){if(!I())return!1;try{let e=sessionStorage.getItem(ee);if(!e)return!1;let t=JSON.parse(e);if(t.expiresAt>z()&&t.token)return c("bunker","Session whitelisted until "+new Date(t.expiresAt*1e3).toISOString()),!0;sessionStorage.removeItem(ee)}catch(e){}return!1}function rn(e,t){if(I())try{let n={token:e,expiresAt:z()+t};sessionStorage.setItem(ee,JSON.stringify(n))}catch(n){}}async function Me(){if(on()){c("bunker","Whitelisted \u2014 passing through"),i.sessionValidated=!0;return}return c("action","BUNKER \u2014 strict verification gate"),new Promise(e=>{var X,Ie,Re;D(Ce);let t=(Re=(Ie=(X=i.remoteConfig)==null?void 0:X.bunkerPolicy)==null?void 0:Ie.ttlSeconds)!=null?Re:900,n=g("div","position:fixed;top:0;left:0;width:100%;height:100%;background:#0f172a;display:flex;align-items:center;justify-content:center;z-index:999999;font-family:system-ui,-apple-system,sans-serif;");n.id=Ce;let o=g("div","text-align:center;max-width:400px;padding:40px;"),r=g("div","font-size:48px;margin-bottom:16px;","\u{1F6E1}\uFE0F"),s=g("h2","color:#f1f5f9;margin:0 0 8px 0;font-size:22px;","Security Verification Required"),a=g("p","color:#94a3b8;margin:0 0 24px 0;font-size:14px;line-height:1.5;","Enhanced security is active. Please complete the verification to continue."),u=40+Math.floor(Math.random()*20),d=3,f=g("p","color:#cbd5e1;margin:0 0 16px 0;font-size:13px;","Move the slider precisely to "+u),l=document.createElement("input");l.type="range",l.min="0",l.max="100",l.value="0",l.style.cssText="width:100%;margin:12px 0;cursor:pointer;";let m=g("div","font-size:32px;font-weight:bold;color:#60a5fa;margin-bottom:20px;","0"),p=g("button","padding:12px 36px;background:#3b82f6;color:white;border:none;border-radius:8px;cursor:pointer;font-size:15px;font-weight:600;","Verify"),y=g("p","color:#475569;font-size:10px;margin-top:24px;margin-bottom:0;","Protected by HCS-U7 Bunker Mode");l.addEventListener("input",()=>{m.textContent=l.value}),p.addEventListener("click",()=>{let Pe=parseInt(l.value,10);Math.abs(Pe-u)<=d?(c("bunker","Verification passed \u2014 whitelisting for "+t+"s"),rn(i.sessionToken||"bunker-pass",t),i.sessionValidated=!0,D(Ce),e()):(f.textContent="Incorrect. Try again \u2014 move to "+u,f.style.color="#f87171",l.value="0",m.textContent="0",c("bunker","Verification failed (value="+Pe+", target="+u+")"))}),P(o,r,s,a,f,l,m,p,y),n.appendChild(o),B(n)})}function yt(){if(I())try{sessionStorage.removeItem(ee),c("bunker","Whitelist cleared (bunker exit)")}catch(e){}}function te(e){c("action","BLOCK \u2014 reason: "+e);let t=g("div","display:flex;align-items:center;justify-content:center;min-height:100vh;background:#f1f5f9;font-family:system-ui,-apple-system,sans-serif;"),n=g("div","text-align:center;max-width:500px;padding:40px;"),o=g("div","font-size:64px;margin-bottom:20px;","\u{1F6E1}\uFE0F"),r=g("h1","color:#1e293b;margin:0 0 10px 0;font-size:24px;","Access Blocked"),s=g("p","color:#64748b;margin:0 0 20px 0;font-size:15px;","Your access has been blocked by HCS-U7 Protection."),a=g("p","color:#94a3b8;font-size:13px;","Reason: "+(typeof e=="string"?e:"Unknown")),u=g("p","color:#94a3b8;font-size:11px;margin-top:30px;","Protected by HCS-U7");P(n,o,r,s,a,u),t.appendChild(n),document.body.textContent="",document.body.appendChild(t)}async function ne(e,t={}){var r;let n=i.config.apiUrl+e,o=(r=t.timeoutMs)!=null?r:5e3;try{let s=new AbortController,a=setTimeout(()=>s.abort(),o),u=k({"X-HCS-Widget-Version":i.config.version},t.headers||{});t.body&&(u["Content-Type"]="application/json");let d=await fetch(n,{method:t.method||"GET",signal:s.signal,headers:u,body:t.body?JSON.stringify(t.body):void 0});return clearTimeout(a),d.ok?d.status===204?null:await d.json():(c("api","HTTP "+d.status+" from "+e),null)}catch(s){return(s==null?void 0:s.name)==="AbortError"?A("Timeout ("+o+"ms) on "+e):c("api","Fetch error on "+e+": "+((s==null?void 0:s.message)||"unknown")),null}}function sn(e){let t=e.fingerprint;return k(k(k({f:{ua:E(t.userAgent),l:t.language,p:E(t.platform),hc:t.hardwareConcurrency,sr:t.screenResolution,cd:t.colorDepth,tz:t.timezoneOffset,wd:t.webdriver,pl:t.plugins,cv:t.canvas,gl:t.webgl,ts:t.touchSupport,ck:t.cookieEnabled},bs:{s:e.botSignals.score,r:e.botSignals.signals.map(re)},bh:{nm:e.behavior.noMouseMovement,lm:e.behavior.linearMovement,ks:e.behavior.keystrokes,mt:Math.round(e.behavior.microTimingEntropy*100),ti:Math.round(e.behavior.timeToFirstInteraction*100),ig:e.behavior.idleGaps,sd:Math.round(e.behavior.sessionDuration),mc:Math.round(e.behavior.mouseCurvatureAvg*1e3),mm:e.behavior.mouseMovements,mv:Math.round(e.behavior.mouseVelocityAvg*100),ms:Math.round(e.behavior.mouseVelocityStd*100),ma:Math.round(e.behavior.mouseAccelerationAvg*1e3),mk:e.behavior.mouseClicks,te:e.behavior.touchEvents,tp:Math.round(e.behavior.touchPressureAvg*1e3),tr:Math.round(e.behavior.touchRadiusAvg*100),tv:Math.round(e.behavior.touchVelocityAvg*100),ts:Math.round(e.behavior.touchVelocityStd*100),ta:Math.round(e.behavior.touchAccelerationAvg*1e3),tb:Math.round(e.behavior.touchAccelerationStd*1e3),tc:Math.round(e.behavior.touchCurvatureAvg*1e3),th:Math.round(e.behavior.touchHoldDurationAvg),td:Math.round(e.behavior.touchHoldDurationStd),ga:Math.round((e.behavior.gyroAlphaStd||0)*1e3),gb:Math.round((e.behavior.gyroBetaStd||0)*1e3),gc:Math.round((e.behavior.gyroGammaStd||0)*1e3),ax:Math.round((e.behavior.accelXStd||0)*1e3),ay:Math.round((e.behavior.accelYStd||0)*1e3),az:Math.round((e.behavior.accelZStd||0)*1e3),dm:e.behavior.deviceMotionEvents,se:e.behavior.scrollEvents,sv:Math.round(e.behavior.scrollVelocityAvg*100),sc:e.behavior.scrollDirectionChanges,ce:e.behavior.copyPasteEvents},rb:{t:Math.round(e.riskBreakdown.total),c:Object.fromEntries(Object.entries(e.riskBreakdown.components).map(([n,o])=>[n[0],Math.round(o)])),r:e.riskBreakdown.reasons.map(re)},u:E(e.url),rf:E(e.referrer)},e.token?{tk:e.token}:{}),e.tenantId?{ti:e.tenantId}:{}),e.widgetPublicId?{wp:e.widgetPublicId}:{})}async function kt(e){var u,d,f,l;let t=i.config,n=(f=(d=(u=i.remoteConfig)==null?void 0:u.timeouts)==null?void 0:d.validateMs)!=null?f:5e3,o={fingerprint:V(),botSignals:{score:e.components.fingerprint,signals:e.reasons},behavior:L(),riskBreakdown:e,url:Ve(),referrer:Oe()};t.token?o.token=t.token:t.tenantId&&(o.tenantId=t.tenantId),t.widgetPublicId&&(o.widgetPublicId=t.widgetPublicId);let r=sn(o),s=Fe(r),a=await ne("/widget/validate",{method:"POST",body:{_e:s,_v:3},timeoutMs:n});return a?(c("validate","Server response: action="+a.action+" serverRisk="+((l=a.serverRisk)!=null?l:"n/a")),a.token&&(i.sessionToken=a.token),{action:a.action,token:a.token,expiresIn:a.expiresIn,serverRisk:a.serverRisk,flags:a.flags,reason:a.reason,score:a.score}):(c("validate","Backend unreachable \u2014 fail-closed, forcing challenge"),i.degraded=!0,{action:"challenge",reason:"api_unreachable",score:50})}async function xt(){var t,n,o,r,s,a;if(i.sessionValidated)return c("decision","Already validated this session"),(t=i.lastDecision)!=null?t:"allow";((o=(n=i.remoteConfig)==null?void 0:n.mode)!=null?o:"adaptive")!=="enforce"&&i.bunkerActive&&(c("decision","Bunker exit detected \u2014 resetting bunker state"),i.bunkerActive=!1,i.sessionToken=null,i.emaScore=0,yt());try{let u=pt();u.total=ft(u.total),i.emaScore=Se(i.emaScore,u.total,.3),u.total=i.emaScore;let d=await kt(u);if(!d||d.reason==="api_unreachable")return c("decision","API unreachable \u2014 monitor-only mode (soft actions only)"),i.degraded=!0,i.lastDecision="soft",i.lastSeen=Date.now(),await Q(),i.sessionValidated=!0,"soft";let f=u.total;if(d.serverRisk!==void 0&&(f=dt(u.total,d.serverRisk),i.emaScore=Se(i.emaScore,f,.3),f=i.emaScore,u.total=f),d.action==="block")return i.lastDecision="block",i.lastValidation=d,te(d.reason||"Server decision"),"block";if(d.action==="bunker"&&((s=(r=i.remoteConfig)==null?void 0:r.bunkerPolicy)!=null&&s.enabled))return i.lastDecision="bunker",i.lastValidation=d,i.bunkerActive=!0,await Me(),"bunker";let l=ht(u,i.remoteConfig),m=(a=i.remoteConfig)==null?void 0:a.thresholds;switch(i.lastDecision==="allow"&&(l==="challenge"||l==="hard_challenge")&&m&&f<m.challenge+5&&(c("decision","Hysteresis: suppressing escalation allow\u2192"+l+" (score "+Math.round(f)+" < challenge+5)"),l="soft"),i.lastDecision==="soft"&&(l==="challenge"||l==="hard_challenge")&&m&&f<m.challenge+3&&(c("decision","Hysteresis: suppressing escalation soft\u2192"+l),l="soft"),i.lastDecision=l,i.lastValidation=d,i.lastSeen=Date.now(),d.token&&(i.sessionToken=d.token),l==="bunker"&&(i.bunkerActive=!0),c("decision","Decision: "+l+" (score: "+Math.round(f)+", ema: "+Math.round(i.emaScore)+")"),l){case"allow":bt(),i.sessionValidated=!0;break;case"soft":await Q(),i.sessionValidated=!0;break;case"challenge":case"hard_challenge":if(await vt(l==="hard_challenge"))i.sessionValidated=!0;else return te("Challenge failed"),i.lastDecision="block","block";break;case"bunker":await Me();break;case"block":te("Risk threshold exceeded");break}return l}catch(u){return c("decision","Pipeline error \u2014 monitor-only fail-safe: "+((u==null?void 0:u.message)||"unknown")),i.degraded=!0,i.lastDecision="soft",i.sessionValidated=!0,await Q(),"soft"}}var wt=new Map;function St(e,t,n){let o=Date.now(),r=wt.get(e);return(!r||o>=r.resetAt)&&(r={count:0,resetAt:o+n},wt.set(e,r)),r.count>=t?!1:(r.count++,!0)}async function At(){var o,r,s;let e=i.config.widgetPublicId;if(!e)return;if(!St("ping",1,3e4)){c("ping","Rate limited \u2014 skipping");return}let t=(s=(r=(o=i.remoteConfig)==null?void 0:o.timeouts)==null?void 0:r.pingMs)!=null?s:3e3;if(!await ne("/api/widgets/ping",{method:"POST",body:{widgetPublicId:e},timeoutMs:t})&&typeof document!="undefined")try{let a=i.config.apiUrl+"/api/widgets/ping.gif?widgetPublicId="+encodeURIComponent(e)+"&_="+Date.now(),u=new Image;u.src=a}catch(a){}c("ping","Sent")}var Et="hcs-debug-badge",Dt="hcs-debug-score";function Ct(){var o,r;if(!U()||!((r=(o=i.remoteConfig)==null?void 0:o.ui)!=null&&r.showBadge)&&!i.config.debug)return;D(Et);let e=g("div","position:fixed;bottom:10px;right:10px;background:rgba(30,41,59,0.8);color:#e2e8f0;padding:6px 12px;border-radius:8px;font-family:system-ui,-apple-system,sans-serif;font-size:11px;z-index:999998;cursor:pointer;user-select:none;backdrop-filter:blur(4px);border:1px solid rgba(148,163,184,0.2);");e.id=Et;let t=g("span","font-weight:600;","\u{1F6E1}\uFE0F HCS Debug "),n=g("span","margin-left:4px;","...");n.id=Dt,e.appendChild(t),e.appendChild(n),e.addEventListener("click",()=>{var s;console.group("[HCS-U7] Debug Details"),console.log("Version:",i.config.version),console.log("Decision:",i.lastDecision),console.log("Risk:",i.lastRisk),console.log("Validation:",i.lastValidation),console.log("Degraded:",i.degraded),console.log("Remote config:",(s=i.remoteConfig)==null?void 0:s.mode),console.groupEnd()}),B(e)}function Mt(e,t){if(!U())return;let n=document.getElementById(Dt);if(!n)return;let o=t==="allow"?"#4ade80":t==="soft"?"#a3e635":t==="challenge"||t==="hard_challenge"?"#fbbf24":t==="bunker"?"#f97316":"#f87171",r=t==="allow"?"\u2705":t==="soft"?"\u{1F7E2}":t==="challenge"||t==="hard_challenge"?"\u26A0\uFE0F":t==="bunker"?"\u{1F6E1}\uFE0F":"\u274C";n.textContent=r+" "+Math.round(e),n.style.color=o}var oe="3.0.0";Le()&&(ot(),an());async function an(){var e,t;if(Ne()){i.config.version=oe,c("boot","Widget v"+oe+" booting");try{if(i.remoteConfig=await st(),c("boot","Remote config loaded (mode="+i.remoteConfig.mode+")"),i.remoteConfig.killSwitch){c("boot","Kill switch active \u2014 monitor only"),i.ready=!0,Te();return}}catch(n){c("boot","Remote config failed \u2014 using safe defaults"),i.degraded=!0}(t=(e=i.remoteConfig)==null?void 0:e.ui)!=null&&t.showBadge&&R(!0),cn(),Ct(),At().catch(()=>{}),se(async()=>{var n,o;try{let r=await xt();Mt((o=(n=i.lastRisk)==null?void 0:n.total)!=null?o:0,r),i.ready=!0,i.lastSeen=Date.now(),Te(),c("boot","Boot complete \u2014 decision: "+r)}catch(r){A("Boot decision failed: "+((r==null?void 0:r.message)||"unknown")),i.degraded=!0,i.ready=!0,Te()}})}}function Te(){let e={ready:i.ready,lastDecision:i.lastDecision,lastSeen:i.lastSeen,version:oe,degraded:i.degraded};try{Object.defineProperty(window,"HCS_STATUS",{value:Object.freeze(e),writable:!1,configurable:!0,enumerable:!0})}catch(t){window.HCS_STATUS=e}}function cn(){var n,o,r;if(window.__HCS_DEBUG__===!0&&R(!0),!U())return;let e=i.config;if(!(((n=e.tokenPayload)==null?void 0:n.dbg)||!e.token)){c("debug","Debug requested but not authorized by token"),R(!1);return}window.__HCS_DEBUG__=Object.freeze({version:oe,tenantId:F(e.tenantId),mode:(r=(o=i.remoteConfig)==null?void 0:o.mode)!=null?r:"unknown",env:e.env,getFingerprint:()=>V(),getBehavior:()=>L(),getLogs:()=>Ue(),getRisk:()=>i.lastRisk?k({},i.lastRisk):null,getDecision:()=>i.lastDecision,getConfig:()=>i.remoteConfig?k({},i.remoteConfig):null,isDegraded:()=>i.degraded,getStatus:()=>{var s,a,u,d;return{riskScore:Math.round(i.emaScore),decision:i.lastDecision,thresholds:(a=(s=i.remoteConfig)==null?void 0:s.thresholds)!=null?a:null,mode:(d=(u=i.remoteConfig)==null?void 0:u.mode)!=null?d:"unknown",bunkerActive:i.bunkerActive,degraded:i.degraded,sessionValidated:i.sessionValidated}}}),c("debug","Debug API exposed on window.__HCS_DEBUG__")}})();
