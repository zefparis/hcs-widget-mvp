/**
 * HCS-U7 Widget v3.0.0 — Enterprise Adaptive Engine
 * Copyright (c) 2025-2026 Benjamin BARRERE / IA SOLUTION
 * Patents Pending FR2514274 | FR2514546
 * Built: 2026-02-11T13:18:17.089Z
 * DO NOT EDIT — generated from src/widget-v3/
 */
"use strict";(()=>{var gt=Object.defineProperty;var we=Object.getOwnPropertySymbols;var pt=Object.prototype.hasOwnProperty,ht=Object.prototype.propertyIsEnumerable;var ve=(e,t,n)=>t in e?gt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,E=(e,t)=>{for(var n in t||(t={}))pt.call(t,n)&&ve(e,n,t[n]);if(we)for(var n of we(t))ht.call(t,n)&&ve(e,n,t[n]);return e};function ke(){return typeof window!="undefined"&&typeof document!="undefined"}function xe(){try{return window.location.href}catch(e){return""}}function Se(){try{return document.referrer}catch(e){return""}}function L(){try{let e="__hcs_test__";return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch(e){return!1}}function A(){try{let e="__hcs_test__";return sessionStorage.setItem(e,"1"),sessionStorage.removeItem(e),!0}catch(e){return!1}}var bt="https://api.hcs-u7.org",i={config:{apiUrl:bt,version:"3.0.0",debug:!1,env:"production",token:null,tenantId:null,widgetPublicId:null,tokenPayload:null},remoteConfig:null,sessionValidated:!1,sessionToken:null,lastDecision:null,lastRisk:null,lastValidation:null,lastSeen:0,degraded:!1,ready:!1,bunkerActive:!1,emaScore:0};function Q(e){let t=5381;for(let n=0;n<e.length;n++)t=(t<<5)+t+e.charCodeAt(n)|0;return Math.abs(t).toString(36)}function Ee(e){try{let n=(e+"====".substring(0,(4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent(atob(n).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join(""))}catch(t){return null}}function V(e){return!e||e.length<8?"***":e.substring(0,4)+"..."+e.substring(e.length-3)}var U=[],ee=!1;function T(e){ee=e}function O(){return ee}function a(e,t){if(!ee)return;let n={t:Date.now(),cat:e,data:t};U.push(n),U.length>200&&U.shift(),console.debug("[HCS-U7]["+e+"]",t)}function k(e){console.error("[HCS-U7] "+e)}function De(){return U.slice()}function Ce(e){if(!e||typeof e!="string")return null;let t=e.split(".");if(t.length!==2)return null;let n=Ee(t[0]);if(!n)return null;try{let o=JSON.parse(n);return!o.tid||!o.exp||!o.v?null:o}catch(o){return null}}function Ae(e){return!e||e.includes(".")?!1:!!(/^[0-9a-f]{8}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{12}$/i.test(e)||/^c[a-z0-9]{20,30}$/.test(e))}function Te(){let e=i.config,t=document.querySelectorAll('script[data-widget], script[data-tenant], script[src*="hcs-widget"]'),n=null;for(let o=0;o<t.length;o++)if(t[o].getAttribute("data-widget")||t[o].getAttribute("data-tenant")||(t[o].getAttribute("src")||"").indexOf("hcs-widget")!==-1){n=t[o];break}if(n&&n.getAttribute("data-widget")){e.widgetPublicId=n.getAttribute("data-widget");let o=n.getAttribute("data-tenant");if(o)if(Ae(o))e.tenantId=o;else{let r=Ce(o);r&&(e.token=o,e.tokenPayload=r,e.tenantId=r.tid)}a("init","Widget public ID from data-widget")}else if(n&&n.getAttribute("data-tenant")){let o=n.getAttribute("data-tenant");if(Ae(o))e.tenantId=o,e.token=null,a("init","Legacy tenant ID from data-tenant");else{let r=Ce(o);if(r)e.token=o,e.tokenPayload=r,e.tenantId=r.tid,r.dbg&&(e.debug=!0),r.env&&(e.env=r.env),a("init","Signed token parsed, tenant: "+V(r.tid));else return k("Invalid data-tenant token format"),!1}}else if(window.HCS_TENANT_ID)e.tenantId=window.HCS_TENANT_ID,e.token=null,a("init","Legacy window.HCS_TENANT_ID mode");else return k("Missing data-widget, data-tenant, or window.HCS_TENANT_ID"),!1;return n&&(n.getAttribute("data-debug")==="true"&&(e.debug=!0),n.getAttribute("data-env")&&(e.env=n.getAttribute("data-env")),n.getAttribute("data-api")&&(e.apiUrl=n.getAttribute("data-api"))),T(e.debug),a("init","Widget v"+e.version+" | tenant: "+V(e.tenantId)+" | mode: "+(e.token?"signed_token":"legacy")),!0}function f(e,t,n){let o=document.createElement(e);return o.style.cssText=t,n!==void 0&&(o.textContent=n),o}function _(e,...t){for(let n of t)e.appendChild(n)}function x(e){let t=document.getElementById(e);t&&t.remove()}function te(e){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()}function R(e){document.body?document.body.appendChild(e):te(()=>document.body.appendChild(e))}var z=0,N=null,re=0,Ie=0,p=[],D=[],W=[],ie=[],Me=0,I={},j=[],G=[],K=[],se=0,Pe=0,Be=0,ae=[],_e=0,ne=0,Le=0,oe=0,Ve=0,Oe=[],He=[],Fe=0,y=[];function h(e){if(!e.length)return 0;let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}function S(e){if(e.length<2)return 0;let t=h(e),n=0;for(let o=0;o<e.length;o++)n+=(e[o]-t)*(e[o]-t);return Math.sqrt(n/(e.length-1))}function Ue(e,t,n){let o=t.x-e.x,r=t.y-e.y,s=n.x-t.x,d=n.y-t.y,l=Math.abs(o*d-r*s),c=Math.sqrt(o*o+r*r),m=Math.sqrt(s*s+d*d),u=n.x-e.x,g=n.y-e.y,b=Math.sqrt(u*u+g*g),w=c*m*b;return w===0?0:2*l/w}function ze(e){if(e.length<5)return .5;let t=[];for(let u=1;u<e.length;u++)t.push(e[u]-e[u-1]);let n=20,o=1/0,r=-1/0;for(let u of t)u<o&&(o=u),u>r&&(r=u);let s=r-o;if(s===0)return 0;let d=new Array(n).fill(0);for(let u of t)d[Math.min(Math.floor((u-o)/s*n),n-1)]++;let l=0,c=t.length;for(let u of d)if(u>0){let g=u/c;l-=g*Math.log2(g)}let m=Math.log2(n);return m>0?l/m:0}function yt(e){if(e.length<3)return 0;let t=h(e),n=S(e);if(n===0)return 0;let o=e.length,r=0;for(let s of e)r+=Math.pow((s-t)/n,3);return o/((o-1)*(o-2))*r}function wt(e){if(e.length<4)return 3;let t=h(e),n=S(e);if(n===0)return 0;let o=0;for(let r of e)o+=Math.pow((r-t)/n,4);return o/e.length-3}function vt(){if(p.length<10)return!1;let e=p.slice(-50),t=0,n=0;for(let o=2;o<e.length;o++)n++,Ue(e[o-2],e[o-1],e[o])<.001&&t++;return n>0&&t/n>.8}function kt(){if(y.length<10)return .5;let e=[];for(let o=1;o<y.length;o++)e.push(y[o]-y[o-1]);let t=0;if(e.length>2){let o=h(e),r=S(e);if(r>0){let s=0;for(let d=1;d<e.length;d++)s+=(e[d]-o)/r*((e[d-1]-o)/r);t=s/(e.length-1)}}let n=ze(y);return n>.85&&Math.abs(t)<.1?.9:n<.15?.1:n}function C(){let e=Date.now();N===null&&(N=e),e-re>3e3&&Ie++,re=e,y.length<500&&y.push(e)}function xt(e){C();let t={x:e.clientX,y:e.clientY,t:performance.now()};if(p.length>0){let n=p[p.length-1],o=t.t-n.t;if(o>0){let r=t.x-n.x,s=t.y-n.y,l=Math.sqrt(r*r+s*s)/o;if(D.length<500&&D.push(l),D.length>=2){let c=D[D.length-2];W.length<500&&W.push((l-c)/o)}if(p.length>=2){let c=p[p.length-2];ie.length<500&&ie.push(Ue(c,n,t))}}}p.length<500?p.push(t):p[p.length-1]=t}function St(){C(),Me++}function Et(e){if(C(),["Shift","Control","Alt","Meta"].indexOf(e.key)!==-1)return;let t=performance.now();if(se>0){let o=t-se;o>0&&o<5e3&&K.length<500&&K.push(o)}let n=Object.keys(I);if(n.length>0&&j.length<500){let o=0;for(let s of n)I[s]>o&&(o=I[s]);let r=t-o;r>0&&r<5e3&&j.push(r)}I[e.code]=t,Pe++}function Dt(e){if(["Shift","Control","Alt","Meta"].indexOf(e.key)!==-1)return;let t=performance.now(),n=I[e.code];if(n!==void 0){let o=t-n;o>0&&o<2e3&&G.length<500&&G.push(o),delete I[e.code]}se=t}function Ct(){C(),Be++;let e=performance.now(),t=window.scrollY||document.documentElement.scrollTop,n=e-ne;if(n>0&&ne>0){let o=t-_e;ae.length<500&&ae.push(Math.abs(o)/n);let r=o>0?1:o<0?-1:0;r!==0&&r!==oe&&oe!==0&&Le++,r!==0&&(oe=r)}_e=t,ne=e}function At(e){C(),Ve++;for(let t=0;t<e.touches.length;t++){let n=e.touches[t];n.force!==void 0&&n.force>0&&Oe.push(n.force),n.radiusX!==void 0&&He.push((n.radiusX+n.radiusY)/2)}}function Re(){C(),Fe++}function Ne(){z=Date.now(),re=z;let e={passive:!0};document.addEventListener("mousemove",xt,e),document.addEventListener("click",St,e),document.addEventListener("keydown",Et,e),document.addEventListener("keyup",Dt,e),document.addEventListener("scroll",Ct,{passive:!0,capture:!0}),document.addEventListener("touchstart",At,e),document.addEventListener("touchmove",()=>C(),e),document.addEventListener("copy",Re,e),document.addEventListener("paste",Re,e)}function M(){let t=(Date.now()-z)/1e3,n=[];for(let o=1;o<y.length;o++)n.push(y[o]-y[o-1]);return{keystrokeIntervalAvg:h(j),keystrokeIntervalStd:S(j),keystrokeDwellAvg:h(G),keystrokeDwellStd:S(G),keystrokes:Pe,flightTimeAvg:h(K),flightTimeStd:S(K),mouseVelocityAvg:h(D),mouseVelocityStd:S(D),mouseAccelerationAvg:h(W),mouseAccelerationStd:S(W),mouseCurvatureAvg:h(ie),mouseMovements:p.length,mouseClicks:Me,noMouseMovement:p.length===0,linearMovement:vt(),scrollEvents:Be,scrollVelocityAvg:h(ae),scrollDirectionChanges:Le,touchEvents:Ve,touchPressureAvg:h(Oe),touchRadiusAvg:h(He),timeToFirstInteraction:N?(N-z)/1e3:t,sessionDuration:t,idleGaps:Ie,timingEntropy:ze(y),copyPasteEvents:Fe,pageViews:1,microTimingEntropy:kt(),timingDistributionSkewness:yt(n),timingDistributionKurtosis:wt(n)}}function P(){let e=navigator;return{userAgent:e.userAgent||"",language:e.language||"",languages:e.languages||[],platform:e.platform||"",hardwareConcurrency:e.hardwareConcurrency||0,deviceMemory:e.deviceMemory||null,screenResolution:screen.width+"x"+screen.height,colorDepth:screen.colorDepth||0,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timezoneOffset:new Date().getTimezoneOffset(),webdriver:!!e.webdriver,plugins:e.plugins?e.plugins.length:0,canvas:Tt(),webgl:_t(),touchSupport:"ontouchstart"in window,cookieEnabled:!!e.cookieEnabled,doNotTrack:e.doNotTrack||null,timestamp:Date.now()}}function Tt(){try{let e=document.createElement("canvas"),t=e.getContext("2d");return t?(e.width=200,e.height=50,t.textBaseline="top",t.font="14px Arial",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText("HCS-U7",2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText("HCS-U7",4,17),Q(e.toDataURL())):""}catch(e){return""}}function _t(){try{let e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return"";let n=t.getExtension("WEBGL_debug_renderer_info");if(!n)return"";let o=t.getParameter(n.UNMASKED_VENDOR_WEBGL),r=t.getParameter(n.UNMASKED_RENDERER_WEBGL);return Q(o+"~"+r)}catch(e){return""}}var X={allow:30,soft:55,challenge:80,bunker:95};var le={mode:"adaptive",thresholds:E({},X),softActions:["pow-lite","js-attestation","silent-retry","token-refresh"],challengeActions:["cognitive-lite"],bunkerPolicy:{enabled:!0,ttlSeconds:900},sampling:{telemetry:.25,fullSignals:.1},privacy:{maskPII:!0},timeouts:{configMs:800,validateMs:1200,pingMs:400},ui:{showBadge:!1,showToastOnChallenge:!0},killSwitch:!1,updatedAt:"",ttlSeconds:300},B=null;function je(){let e=i.config.widgetPublicId||i.config.tenantId||"unknown",t=typeof window!="undefined"?window.location.hostname:"";return"hcs:cfg:"+e+":"+t}function Rt(){if(!L())return null;try{let e=localStorage.getItem(je());if(!e)return null;let t=JSON.parse(e);return!t.config||!t.fetchedAt?null:t}catch(e){return null}}function It(e){if(L())try{localStorage.setItem(je(),JSON.stringify(e))}catch(t){}}function We(e){let t=(e.config.ttlSeconds||300)*1e3;return Date.now()-e.fetchedAt<t}async function Ge(){var o,r;if(B&&We(B))return a("config","Using memory cache"),B.config;let e=Rt();if(e&&We(e))return B=e,a("config","Using localStorage cache"),e.config;let t=i.config.widgetPublicId;if(!t)return a("config","No widgetPublicId \u2014 using safe defaults"),le;let n=((r=(o=e==null?void 0:e.config)==null?void 0:o.timeouts)==null?void 0:r.configMs)||le.timeouts.configMs;try{let s=new AbortController,d=setTimeout(()=>s.abort(),n),l=i.config.apiUrl+"/api/widgets/config?widgetPublicId="+encodeURIComponent(t),c=await fetch(l,{method:"GET",signal:s.signal,headers:{"X-HCS-Widget-Version":i.config.version}});if(clearTimeout(d),!c.ok)throw new Error("HTTP "+c.status);let m=await c.json();if(!m.thresholds||typeof m.mode!="string")throw new Error("Invalid config shape");let u={config:m,fetchedAt:Date.now()};return B=u,It(u),a("config","Fetched remote config (mode="+m.mode+")"),m}catch(s){return k("config_fetch_failed: "+((s==null?void 0:s.message)||"unknown")),e?(a("config","Using stale localStorage cache as fallback"),B=e,e.config):(a("config","No cache \u2014 using safe defaults"),le)}}function Ke(e){let t=[],n=0;e.webdriver&&(t.push("webdriver"),n+=50),e.plugins===0&&(t.push("no_plugins"),n+=20);let o=["headless","phantom","selenium","puppeteer","bot","crawler","spider"],r=e.userAgent.toLowerCase();return o.some(s=>r.indexOf(s)!==-1)&&(t.push("suspicious_ua"),n+=40),e.languages.length===0&&(t.push("no_languages"),n+=15),(e.hardwareConcurrency===0||e.hardwareConcurrency>32)&&(t.push("abnormal_hw"),n+=10),(!e.canvas||e.canvas.length<5)&&(t.push("invalid_canvas"),n+=25),(!e.webgl||e.webgl.length<5)&&(t.push("invalid_webgl"),n+=20),e.cookieEnabled||(t.push("cookies_disabled"),n+=10),(e.timezone==="UTC"||e.timezoneOffset===0)&&(t.push("utc_tz"),n+=5),{score:Math.min(100,n),signals:t,suspicious:n>=50}}function Xe(e){let t=[],n=0;return e.noMouseMovement&&e.sessionDuration>2&&(t.push("no_mouse"),n+=15),e.linearMovement&&(t.push("linear_mouse"),n+=20),e.keystrokes===0&&e.sessionDuration>5&&(t.push("no_keystrokes"),n+=5),e.microTimingEntropy>.85&&(t.push("artificial_timing"),n+=25),e.microTimingEntropy<.15&&e.sessionDuration>2&&(t.push("robotic_timing"),n+=20),e.timeToFirstInteraction<.1&&e.sessionDuration>1&&(t.push("instant_interaction"),n+=15),e.idleGaps===0&&e.sessionDuration>30&&(t.push("no_idle"),n+=10),e.keystrokeDwellStd<5&&e.keystrokes>10&&(t.push("uniform_dwell"),n+=15),e.mouseCurvatureAvg<.001&&e.mouseMovements>20&&(t.push("zero_curvature"),n+=15),{score:Math.min(100,n),signals:t}}function qe(){return{storageAvailable:L()&&A(),cookiesEnabled:!!navigator.cookieEnabled,cspBlocked:!1,adblockDetected:!1}}function v(e){return Math.max(0,Math.min(100,e))}function Ye(e,t){var r;let n=0,o=0;for(let s of Object.keys(t)){let d=(r=e[s])!=null?r:0,l=t[s];n+=v(d)*l,o+=l}return o>0?v(n/o):0}function ce(e,t,n=.3){return e===0?t:v(n*t+(1-n)*e)}function Je(e,t){return v(e*.4+t*.6)}function $e(e){var d;if(typeof window=="undefined")return e;let t=((d=window.location)==null?void 0:d.hostname)||"",n=document.referrer||"",o=t==="localhost"||t==="127.0.0.1"||t==="0.0.0.0",r=n==="",s=!!window.__REACT_DEVTOOLS_GLOBAL_HOOK__||typeof window.__VUE_DEVTOOLS_GLOBAL_HOOK__!="undefined";return o||s||r?v(e*.6):e}function H(){return Math.floor(Date.now()/1e3)}function Ze(e){return new Promise(t=>setTimeout(t,e))}function Qe(e,t=.2){let n=e*t;return e+(Math.random()*2-1)*n}var Mt={fingerprint:.25,behavior:.3,automation:.2,integrity:.1,velocity:.1,network:.05},ue=0;function et(){let e=[],t=P(),n=Ke(t);e.push(...n.signals);let o=M(),r=Xe(o);e.push(...r.signals);let s=0;t.webdriver&&(s+=60),n.signals.includes("suspicious_ua")&&(s+=40),s=v(s);let d=qe(),l=0;d.storageAvailable||(l+=20,e.push("no_storage")),d.cookiesEnabled||(l+=15,e.push("no_cookies")),d.cspBlocked&&(l+=10,e.push("csp_blocked")),l=v(l);let c=0,m=H();ue>0&&m-ue<2&&(c=30,e.push("rapid_assess")),ue=m;let g={fingerprint:v(n.score),behavior:v(r.score),automation:s,integrity:l,velocity:c,network:0},b=Ye(g,Mt),w={total:b,components:g,reasons:e};return a("risk","Score: "+Math.round(b)+" | reasons: "+e.join(", ")),i.lastRisk=w,w}function tt(e,t){var r,s,d;let n=(r=t==null?void 0:t.thresholds)!=null?r:X,o=e.total;return t!=null&&t.killSwitch||(t==null?void 0:t.mode)==="monitor"?"allow":(s=t==null?void 0:t.bunkerPolicy)!=null&&s.enabled&&o>=n.bunker?"bunker":o<n.allow?"allow":o<n.soft?"soft":o<n.challenge?"challenge":o<n.bunker?"hard_challenge":(d=t==null?void 0:t.bunkerPolicy)!=null&&d.enabled?"bunker":"block"}function nt(){a("action","ALLOW \u2014 no friction")}function Pt(){return new Promise(e=>{let t=150+Math.random()*150,n=performance.now(),o=0,r=0;function s(){let d=performance.now()+5;for(;performance.now()<d;)o=(o<<5)-o+r|0,r++;performance.now()-n>=t?(a("soft","PoW-lite completed: "+r+" iterations in "+Math.round(performance.now()-n)+"ms"),e()):setTimeout(s,0)}s()})}function Bt(){return new Promise(e=>{let t=performance.now(),o=document.createElement("canvas").getContext("2d");o&&o.fillText("attest",0,0);let r=[typeof window.requestAnimationFrame=="function",typeof document.createTreeWalker=="function",typeof window.getComputedStyle=="function"],s=performance.now()-t;a("soft","JS attestation: "+r.filter(Boolean).length+"/3 checks, "+Math.round(s)+"ms"),e()})}async function Lt(){let e=Qe(500,.3);a("soft","Silent retry in "+Math.round(e)+"ms"),await Ze(e)}function Vt(){a("soft","Token refresh requested")}async function q(){var t,n;let e=(n=(t=i.remoteConfig)==null?void 0:t.softActions)!=null?n:["pow-lite","js-attestation"];a("action","SOFT \u2014 executing: "+e.join(", "));for(let o of e)switch(o){case"pow-lite":await Pt();break;case"js-attestation":await Bt();break;case"silent-retry":await Lt();break;case"token-refresh":Vt();break;default:a("soft","Unknown soft action: "+o)}}var de="hcs-challenge-overlay";async function ot(e=!1){var n,o,r,s;let t=e?(o=(n=i.remoteConfig)==null?void 0:n.challengeActions)!=null?o:["cognitive-lite"]:["cognitive-lite"];a("action",(e?"HARD_":"")+"CHALLENGE \u2014 actions: "+t.join(", "));for(let d of t)switch(d){case"cognitive-lite":return fe();case"voice-if-enabled":return(s=(r=i.remoteConfig)==null?void 0:r.challengeActions)!=null&&s.includes("voice-if-enabled")&&a("challenge","Voice challenge not yet implemented \u2014 falling back to cognitive-lite"),fe();default:return a("challenge","Unknown challenge action: "+d),fe()}return!0}function fe(){return new Promise(e=>{x(de);let t=30+Math.floor(Math.random()*40),n=5,o=Date.now(),r=f("div","position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:999999;");r.id=de;let s=f("div","background:white;border-radius:12px;box-shadow:0 20px 25px -5px rgba(0,0,0,0.1);max-width:420px;width:90%;padding:30px;text-align:center;"),d=f("h3","margin:0 0 12px 0;color:#1e293b;font-family:system-ui,-apple-system,sans-serif;font-size:18px;","Human Verification"),l=f("p","margin:0 0 20px 0;color:#64748b;font-size:14px;font-family:system-ui,-apple-system,sans-serif;","Move the slider to "+t),c=document.createElement("input");c.type="range",c.min="0",c.max="100",c.value="0",c.style.cssText="width:100%;margin:16px 0;cursor:pointer;";let m=f("div","font-size:28px;font-weight:bold;color:#3b82f6;font-family:system-ui,-apple-system,sans-serif;margin-bottom:16px;","0"),u=f("button","padding:10px 30px;background:#3b82f6;color:white;border:none;border-radius:6px;cursor:pointer;font-size:15px;font-family:system-ui,-apple-system,sans-serif;font-weight:600;","Validate"),g=f("p","color:#cbd5e1;font-size:10px;margin-top:16px;margin-bottom:0;font-family:system-ui,-apple-system,sans-serif;","Protected by HCS-U7");c.addEventListener("input",()=>{m.textContent=c.value}),u.addEventListener("click",()=>{let b=parseInt(c.value,10),w=Math.abs(b-t)<=n,F=Date.now()-o;a("challenge","Cognitive-lite result: "+(w?"PASS":"FAIL")+" (value="+b+", target="+t+", duration="+F+"ms)"),x(de),e(w)}),_(s,d,l,c,m,u,g),r.appendChild(s),R(r)})}var me="hcs-bunker-overlay",Y="hcs:bunker:whitelist";function Ot(){if(!A())return!1;try{let e=sessionStorage.getItem(Y);if(!e)return!1;let t=JSON.parse(e);if(t.expiresAt>H()&&t.token)return a("bunker","Session whitelisted until "+new Date(t.expiresAt*1e3).toISOString()),!0;sessionStorage.removeItem(Y)}catch(e){}return!1}function Ht(e,t){if(A())try{let n={token:e,expiresAt:H()+t};sessionStorage.setItem(Y,JSON.stringify(n))}catch(n){}}async function ge(){if(Ot()){a("bunker","Whitelisted \u2014 passing through"),i.sessionValidated=!0;return}return a("action","BUNKER \u2014 strict verification gate"),new Promise(e=>{var F,he,be;x(me);let t=(be=(he=(F=i.remoteConfig)==null?void 0:F.bunkerPolicy)==null?void 0:he.ttlSeconds)!=null?be:900,n=f("div","position:fixed;top:0;left:0;width:100%;height:100%;background:#0f172a;display:flex;align-items:center;justify-content:center;z-index:999999;font-family:system-ui,-apple-system,sans-serif;");n.id=me;let o=f("div","text-align:center;max-width:400px;padding:40px;"),r=f("div","font-size:48px;margin-bottom:16px;","\u{1F6E1}\uFE0F"),s=f("h2","color:#f1f5f9;margin:0 0 8px 0;font-size:22px;","Security Verification Required"),d=f("p","color:#94a3b8;margin:0 0 24px 0;font-size:14px;line-height:1.5;","Enhanced security is active. Please complete the verification to continue."),l=40+Math.floor(Math.random()*20),c=3,m=f("p","color:#cbd5e1;margin:0 0 16px 0;font-size:13px;","Move the slider precisely to "+l),u=document.createElement("input");u.type="range",u.min="0",u.max="100",u.value="0",u.style.cssText="width:100%;margin:12px 0;cursor:pointer;";let g=f("div","font-size:32px;font-weight:bold;color:#60a5fa;margin-bottom:20px;","0"),b=f("button","padding:12px 36px;background:#3b82f6;color:white;border:none;border-radius:8px;cursor:pointer;font-size:15px;font-weight:600;","Verify"),w=f("p","color:#475569;font-size:10px;margin-top:24px;margin-bottom:0;","Protected by HCS-U7 Bunker Mode");u.addEventListener("input",()=>{g.textContent=u.value}),b.addEventListener("click",()=>{let ye=parseInt(u.value,10);Math.abs(ye-l)<=c?(a("bunker","Verification passed \u2014 whitelisting for "+t+"s"),Ht(i.sessionToken||"bunker-pass",t),i.sessionValidated=!0,x(me),e()):(m.textContent="Incorrect. Try again \u2014 move to "+l,m.style.color="#f87171",u.value="0",g.textContent="0",a("bunker","Verification failed (value="+ye+", target="+l+")"))}),_(o,r,s,d,m,u,g,b,w),n.appendChild(o),R(n)})}function rt(){if(A())try{sessionStorage.removeItem(Y),a("bunker","Whitelist cleared (bunker exit)")}catch(e){}}function J(e){a("action","BLOCK \u2014 reason: "+e);let t=f("div","display:flex;align-items:center;justify-content:center;min-height:100vh;background:#f1f5f9;font-family:system-ui,-apple-system,sans-serif;"),n=f("div","text-align:center;max-width:500px;padding:40px;"),o=f("div","font-size:64px;margin-bottom:20px;","\u{1F6E1}\uFE0F"),r=f("h1","color:#1e293b;margin:0 0 10px 0;font-size:24px;","Access Blocked"),s=f("p","color:#64748b;margin:0 0 20px 0;font-size:15px;","Your access has been blocked by HCS-U7 Protection."),d=f("p","color:#94a3b8;font-size:13px;","Reason: "+(typeof e=="string"?e:"Unknown")),l=f("p","color:#94a3b8;font-size:11px;margin-top:30px;","Protected by HCS-U7");_(n,o,r,s,d,l),t.appendChild(n),document.body.textContent="",document.body.appendChild(t)}async function $(e,t={}){var r;let n=i.config.apiUrl+e,o=(r=t.timeoutMs)!=null?r:1200;try{let s=new AbortController,d=setTimeout(()=>s.abort(),o),l=E({"X-HCS-Widget-Version":i.config.version},t.headers||{});t.body&&(l["Content-Type"]="application/json");let c=await fetch(n,{method:t.method||"GET",signal:s.signal,headers:l,body:t.body?JSON.stringify(t.body):void 0});return clearTimeout(d),c.ok?c.status===204?null:await c.json():(a("api","HTTP "+c.status+" from "+e),null)}catch(s){return(s==null?void 0:s.name)==="AbortError"?k("Timeout ("+o+"ms) on "+e):a("api","Fetch error on "+e+": "+((s==null?void 0:s.message)||"unknown")),null}}async function it(e){var s,d,l,c;let t=i.config,n=(l=(d=(s=i.remoteConfig)==null?void 0:s.timeouts)==null?void 0:d.validateMs)!=null?l:1200,o={fingerprint:P(),botSignals:{score:e.components.fingerprint,signals:e.reasons},behavior:M(),riskBreakdown:e,url:xe(),referrer:Se()};t.token?o.token=t.token:t.tenantId&&(o.tenantId=t.tenantId),t.widgetPublicId&&(o.widgetPublicId=t.widgetPublicId);let r=await $("/widget/validate",{method:"POST",body:o,timeoutMs:n});return r?(a("validate","Server response: action="+r.action+" serverRisk="+((c=r.serverRisk)!=null?c:"n/a")),r.token&&(i.sessionToken=r.token),{action:r.action,token:r.token,expiresIn:r.expiresIn,serverRisk:r.serverRisk,flags:r.flags,reason:r.reason,score:r.score}):(a("validate","Backend unreachable \u2014 degraded mode"),i.degraded=!0,{action:"allow",reason:"api_unreachable",score:0})}async function st(){var t,n,o,r,s,d;if(i.sessionValidated)return a("decision","Already validated this session"),(t=i.lastDecision)!=null?t:"allow";((o=(n=i.remoteConfig)==null?void 0:n.mode)!=null?o:"adaptive")!=="enforce"&&i.bunkerActive&&(a("decision","Bunker exit detected \u2014 resetting bunker state"),i.bunkerActive=!1,i.sessionToken=null,i.emaScore=0,rt());try{let l=et();l.total=$e(l.total),i.emaScore=ce(i.emaScore,l.total,.3),l.total=i.emaScore;let c=await it(l);if(!c||c.reason==="api_unreachable")return a("decision","API unreachable \u2014 monitor-only mode (soft actions only)"),i.degraded=!0,i.lastDecision="soft",i.lastSeen=Date.now(),await q(),i.sessionValidated=!0,"soft";let m=l.total;if(c.serverRisk!==void 0&&(m=Je(l.total,c.serverRisk),i.emaScore=ce(i.emaScore,m,.3),m=i.emaScore,l.total=m),c.action==="block")return i.lastDecision="block",i.lastValidation=c,J(c.reason||"Server decision"),"block";if(c.action==="bunker"&&((s=(r=i.remoteConfig)==null?void 0:r.bunkerPolicy)!=null&&s.enabled))return i.lastDecision="bunker",i.lastValidation=c,i.bunkerActive=!0,await ge(),"bunker";let u=tt(l,i.remoteConfig),g=(d=i.remoteConfig)==null?void 0:d.thresholds;switch(i.lastDecision==="allow"&&(u==="challenge"||u==="hard_challenge")&&g&&m<g.challenge+5&&(a("decision","Hysteresis: suppressing escalation allow\u2192"+u+" (score "+Math.round(m)+" < challenge+5)"),u="soft"),i.lastDecision==="soft"&&(u==="challenge"||u==="hard_challenge")&&g&&m<g.challenge+3&&(a("decision","Hysteresis: suppressing escalation soft\u2192"+u),u="soft"),i.lastDecision=u,i.lastValidation=c,i.lastSeen=Date.now(),c.token&&(i.sessionToken=c.token),u==="bunker"&&(i.bunkerActive=!0),a("decision","Decision: "+u+" (score: "+Math.round(m)+", ema: "+Math.round(i.emaScore)+")"),u){case"allow":nt(),i.sessionValidated=!0;break;case"soft":await q(),i.sessionValidated=!0;break;case"challenge":case"hard_challenge":if(await ot(u==="hard_challenge"))i.sessionValidated=!0;else return J("Challenge failed"),i.lastDecision="block","block";break;case"bunker":await ge();break;case"block":J("Risk threshold exceeded");break}return u}catch(l){return a("decision","Pipeline error \u2014 monitor-only fail-safe: "+((l==null?void 0:l.message)||"unknown")),i.degraded=!0,i.lastDecision="soft",i.sessionValidated=!0,await q(),"soft"}}var at=new Map;function lt(e,t,n){let o=Date.now(),r=at.get(e);return(!r||o>=r.resetAt)&&(r={count:0,resetAt:o+n},at.set(e,r)),r.count>=t?!1:(r.count++,!0)}async function ct(){var n,o,r;let e=i.config.widgetPublicId;if(!e)return;if(!lt("ping",1,3e4)){a("ping","Rate limited \u2014 skipping");return}let t=(r=(o=(n=i.remoteConfig)==null?void 0:n.timeouts)==null?void 0:o.pingMs)!=null?r:400;await $("/api/widgets/ping",{method:"POST",body:{widgetPublicId:e},timeoutMs:t}),a("ping","Sent")}var ut="hcs-debug-badge",dt="hcs-debug-score";function ft(){var o,r;if(!O()||!((r=(o=i.remoteConfig)==null?void 0:o.ui)!=null&&r.showBadge)&&!i.config.debug)return;x(ut);let e=f("div","position:fixed;bottom:10px;right:10px;background:rgba(30,41,59,0.8);color:#e2e8f0;padding:6px 12px;border-radius:8px;font-family:system-ui,-apple-system,sans-serif;font-size:11px;z-index:999998;cursor:pointer;user-select:none;backdrop-filter:blur(4px);border:1px solid rgba(148,163,184,0.2);");e.id=ut;let t=f("span","font-weight:600;","\u{1F6E1}\uFE0F HCS Debug "),n=f("span","margin-left:4px;","...");n.id=dt,e.appendChild(t),e.appendChild(n),e.addEventListener("click",()=>{var s;console.group("[HCS-U7] Debug Details"),console.log("Version:",i.config.version),console.log("Decision:",i.lastDecision),console.log("Risk:",i.lastRisk),console.log("Validation:",i.lastValidation),console.log("Degraded:",i.degraded),console.log("Remote config:",(s=i.remoteConfig)==null?void 0:s.mode),console.groupEnd()}),R(e)}function mt(e,t){if(!O())return;let n=document.getElementById(dt);if(!n)return;let o=t==="allow"?"#4ade80":t==="soft"?"#a3e635":t==="challenge"||t==="hard_challenge"?"#fbbf24":t==="bunker"?"#f97316":"#f87171",r=t==="allow"?"\u2705":t==="soft"?"\u{1F7E2}":t==="challenge"||t==="hard_challenge"?"\u26A0\uFE0F":t==="bunker"?"\u{1F6E1}\uFE0F":"\u274C";n.textContent=r+" "+Math.round(e),n.style.color=o}var Z="3.0.0";ke()&&(Ne(),Ft());async function Ft(){var e,t;if(Te()){i.config.version=Z,a("boot","Widget v"+Z+" booting");try{if(i.remoteConfig=await Ge(),a("boot","Remote config loaded (mode="+i.remoteConfig.mode+")"),i.remoteConfig.killSwitch){a("boot","Kill switch active \u2014 monitor only"),i.ready=!0,pe();return}}catch(n){a("boot","Remote config failed \u2014 using safe defaults"),i.degraded=!0}(t=(e=i.remoteConfig)==null?void 0:e.ui)!=null&&t.showBadge&&T(!0),Ut(),ft(),ct().catch(()=>{}),te(async()=>{var n,o;try{let r=await st();mt((o=(n=i.lastRisk)==null?void 0:n.total)!=null?o:0,r),i.ready=!0,i.lastSeen=Date.now(),pe(),a("boot","Boot complete \u2014 decision: "+r)}catch(r){k("Boot decision failed: "+((r==null?void 0:r.message)||"unknown")),i.degraded=!0,i.ready=!0,pe()}})}}function pe(){let e={ready:i.ready,lastDecision:i.lastDecision,lastSeen:i.lastSeen,version:Z,degraded:i.degraded};try{Object.defineProperty(window,"HCS_STATUS",{value:Object.freeze(e),writable:!1,configurable:!0,enumerable:!0})}catch(t){window.HCS_STATUS=e}}function Ut(){var n,o,r;if(window.__HCS_DEBUG__===!0&&T(!0),!O())return;let e=i.config;if(!(((n=e.tokenPayload)==null?void 0:n.dbg)||!e.token)){a("debug","Debug requested but not authorized by token"),T(!1);return}window.__HCS_DEBUG__=Object.freeze({version:Z,tenantId:V(e.tenantId),mode:(r=(o=i.remoteConfig)==null?void 0:o.mode)!=null?r:"unknown",env:e.env,getFingerprint:()=>P(),getBehavior:()=>M(),getLogs:()=>De(),getRisk:()=>i.lastRisk?E({},i.lastRisk):null,getDecision:()=>i.lastDecision,getConfig:()=>i.remoteConfig?E({},i.remoteConfig):null,isDegraded:()=>i.degraded,getStatus:()=>{var s,d,l,c;return{riskScore:Math.round(i.emaScore),decision:i.lastDecision,thresholds:(d=(s=i.remoteConfig)==null?void 0:s.thresholds)!=null?d:null,mode:(c=(l=i.remoteConfig)==null?void 0:l.mode)!=null?c:"unknown",bunkerActive:i.bunkerActive,degraded:i.degraded,sessionValidated:i.sessionValidated}}}),a("debug","Debug API exposed on window.__HCS_DEBUG__")}})();
